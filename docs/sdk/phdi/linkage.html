<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 13.0.0"/>
    <title>phdi.linkage API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../phdi.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;phdi</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="function" href="#generate_hash_str">generate_hash_str</a>
            </li>
            <li>
                    <a class="function" href="#block_data">block_data</a>
            </li>
            <li>
                    <a class="function" href="#match_within_block">match_within_block</a>
            </li>
            <li>
                    <a class="function" href="#feature_match_exact">feature_match_exact</a>
            </li>
            <li>
                    <a class="function" href="#feature_match_fuzzy_string">feature_match_fuzzy_string</a>
            </li>
            <li>
                    <a class="function" href="#eval_perfect_match">eval_perfect_match</a>
            </li>
            <li>
                    <a class="function" href="#compile_match_lists">compile_match_lists</a>
            </li>
            <li>
                    <a class="function" href="#feature_match_four_char">feature_match_four_char</a>
            </li>
            <li>
                    <a class="function" href="#perform_linkage_pass">perform_linkage_pass</a>
            </li>
            <li>
                    <a class="function" href="#score_linkage_vs_truth">score_linkage_vs_truth</a>
            </li>
            <li>
                    <a class="function" href="#block_data_from_db">block_data_from_db</a>
            </li>
            <li>
                    <a class="function" href="#_generate_block_query">_generate_block_query</a>
            </li>
            <li>
                    <a class="function" href="#calculate_m_probs">calculate_m_probs</a>
            </li>
            <li>
                    <a class="function" href="#calculate_u_probs">calculate_u_probs</a>
            </li>
            <li>
                    <a class="function" href="#load_json_probs">load_json_probs</a>
            </li>
            <li>
                    <a class="function" href="#calculate_log_odds">calculate_log_odds</a>
            </li>
            <li>
                    <a class="function" href="#feature_match_log_odds_exact">feature_match_log_odds_exact</a>
            </li>
            <li>
                    <a class="function" href="#feature_match_log_odds_fuzzy_compare">feature_match_log_odds_fuzzy_compare</a>
            </li>
            <li>
                    <a class="function" href="#profile_log_odds">profile_log_odds</a>
            </li>
            <li>
                    <a class="function" href="#eval_log_odds_cutoff">eval_log_odds_cutoff</a>
            </li>
            <li>
                    <a class="class" href="#BaseMPIConnectorClient">BaseMPIConnectorClient</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#BaseMPIConnectorClient.block_data">block_data</a>
                        </li>
                        <li>
                                <a class="function" href="#BaseMPIConnectorClient.upsert_match_patient">upsert_match_patient</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../phdi.html">phdi</a><wbr>.linkage    </h1>

                
                        <input id="mod-linkage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-linkage-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="kn">from</span> <span class="nn">phdi.linkage.link</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a>    <span class="n">generate_hash_str</span><span class="p">,</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a>    <span class="n">block_data</span><span class="p">,</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a>    <span class="n">match_within_block</span><span class="p">,</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a>    <span class="n">feature_match_exact</span><span class="p">,</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a>    <span class="n">feature_match_fuzzy_string</span><span class="p">,</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a>    <span class="n">eval_perfect_match</span><span class="p">,</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a>    <span class="n">compile_match_lists</span><span class="p">,</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a>    <span class="n">feature_match_four_char</span><span class="p">,</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a>    <span class="n">perform_linkage_pass</span><span class="p">,</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a>    <span class="n">score_linkage_vs_truth</span><span class="p">,</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a>    <span class="n">block_data_from_db</span><span class="p">,</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a>    <span class="n">_generate_block_query</span><span class="p">,</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a>    <span class="n">calculate_m_probs</span><span class="p">,</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a>    <span class="n">calculate_u_probs</span><span class="p">,</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a>    <span class="n">load_json_probs</span><span class="p">,</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a>    <span class="n">calculate_log_odds</span><span class="p">,</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a>    <span class="n">feature_match_log_odds_exact</span><span class="p">,</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">19</span></a>    <span class="n">feature_match_log_odds_fuzzy_compare</span><span class="p">,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">20</span></a>    <span class="n">profile_log_odds</span><span class="p">,</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">21</span></a>    <span class="n">eval_log_odds_cutoff</span><span class="p">,</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">22</span></a><span class="p">)</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos">24</span></a><span class="kn">from</span> <span class="nn">phdi.linkage.core</span> <span class="kn">import</span> <span class="n">BaseMPIConnectorClient</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos">26</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">27</span></a>    <span class="s2">&quot;generate_hash_str&quot;</span><span class="p">,</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">28</span></a>    <span class="s2">&quot;block_data&quot;</span><span class="p">,</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">29</span></a>    <span class="s2">&quot;match_within_block&quot;</span><span class="p">,</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">30</span></a>    <span class="s2">&quot;feature_match_exact&quot;</span><span class="p">,</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">31</span></a>    <span class="s2">&quot;feature_match_fuzzy_string&quot;</span><span class="p">,</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">32</span></a>    <span class="s2">&quot;eval_perfect_match&quot;</span><span class="p">,</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">33</span></a>    <span class="s2">&quot;compile_match_lists&quot;</span><span class="p">,</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">34</span></a>    <span class="s2">&quot;feature_match_four_char&quot;</span><span class="p">,</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">35</span></a>    <span class="s2">&quot;perform_linkage_pass&quot;</span><span class="p">,</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">36</span></a>    <span class="s2">&quot;score_linkage_vs_truth&quot;</span><span class="p">,</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">37</span></a>    <span class="s2">&quot;block_data_from_db&quot;</span><span class="p">,</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">38</span></a>    <span class="s2">&quot;_generate_block_query&quot;</span><span class="p">,</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">39</span></a>    <span class="s2">&quot;calculate_m_probs&quot;</span><span class="p">,</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">40</span></a>    <span class="s2">&quot;calculate_u_probs&quot;</span><span class="p">,</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">41</span></a>    <span class="s2">&quot;load_json_probs&quot;</span><span class="p">,</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">42</span></a>    <span class="s2">&quot;calculate_log_odds&quot;</span><span class="p">,</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">43</span></a>    <span class="s2">&quot;feature_match_log_odds_exact&quot;</span><span class="p">,</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">44</span></a>    <span class="s2">&quot;feature_match_log_odds_fuzzy_compare&quot;</span><span class="p">,</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">45</span></a>    <span class="s2">&quot;profile_log_odds&quot;</span><span class="p">,</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">46</span></a>    <span class="s2">&quot;eval_log_odds_cutoff&quot;</span><span class="p">,</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">47</span></a>    <span class="s2">&quot;BaseMPIConnectorClient&quot;</span><span class="p">,</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">48</span></a><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="generate_hash_str">
                            <input id="generate_hash_str-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">generate_hash_str</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">linking_identifier</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">salt_str</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="generate_hash_str-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#generate_hash_str"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="generate_hash_str-377"><a href="#generate_hash_str-377"><span class="linenos">377</span></a><span class="k">def</span> <span class="nf">generate_hash_str</span><span class="p">(</span><span class="n">linking_identifier</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">salt_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="generate_hash_str-378"><a href="#generate_hash_str-378"><span class="linenos">378</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="generate_hash_str-379"><a href="#generate_hash_str-379"><span class="linenos">379</span></a><span class="sd">    Generates a hash for a given string of concatenated patient information. The hash</span>
</span><span id="generate_hash_str-380"><a href="#generate_hash_str-380"><span class="linenos">380</span></a><span class="sd">    serves as a &quot;unique&quot; identifier for the patient.</span>
</span><span id="generate_hash_str-381"><a href="#generate_hash_str-381"><span class="linenos">381</span></a>
</span><span id="generate_hash_str-382"><a href="#generate_hash_str-382"><span class="linenos">382</span></a><span class="sd">    :param linking_identifier: The value to be hashed.  For example, the concatenation</span>
</span><span id="generate_hash_str-383"><a href="#generate_hash_str-383"><span class="linenos">383</span></a><span class="sd">      of a patient&#39;s name, address, and date of birth, delimited by dashes.</span>
</span><span id="generate_hash_str-384"><a href="#generate_hash_str-384"><span class="linenos">384</span></a><span class="sd">    :param salt_str: The salt to use with the hash. This is intended to prevent</span>
</span><span id="generate_hash_str-385"><a href="#generate_hash_str-385"><span class="linenos">385</span></a><span class="sd">      reverse engineering of the PII used to create the hash.</span>
</span><span id="generate_hash_str-386"><a href="#generate_hash_str-386"><span class="linenos">386</span></a><span class="sd">    :return: The hash of the linking_identifier string.</span>
</span><span id="generate_hash_str-387"><a href="#generate_hash_str-387"><span class="linenos">387</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="generate_hash_str-388"><a href="#generate_hash_str-388"><span class="linenos">388</span></a>    <span class="n">hash_obj</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">()</span>
</span><span id="generate_hash_str-389"><a href="#generate_hash_str-389"><span class="linenos">389</span></a>    <span class="n">to_encode</span> <span class="o">=</span> <span class="p">(</span><span class="n">linking_identifier</span> <span class="o">+</span> <span class="n">salt_str</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="generate_hash_str-390"><a href="#generate_hash_str-390"><span class="linenos">390</span></a>    <span class="n">hash_obj</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">to_encode</span><span class="p">)</span>
</span><span id="generate_hash_str-391"><a href="#generate_hash_str-391"><span class="linenos">391</span></a>    <span class="k">return</span> <span class="n">hash_obj</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Generates a hash for a given string of concatenated patient information. The hash
serves as a "unique" identifier for the patient.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>linking_identifier</strong>:  The value to be hashed.  For example, the concatenation
of a patient's name, address, and date of birth, delimited by dashes.</li>
<li><strong>salt_str</strong>:  The salt to use with the hash. This is intended to prevent
reverse engineering of the PII used to create the hash.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The hash of the linking_identifier string.</p>
</blockquote>
</div>


                </section>
                <section id="block_data">
                            <input id="block_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">block_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">data</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>, </span><span class="param"><span class="n">blocks</span><span class="p">:</span> <span class="n">List</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="block_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#block_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="block_data-15"><a href="#block_data-15"><span class="linenos">15</span></a><span class="k">def</span> <span class="nf">block_data</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">blocks</span><span class="p">:</span> <span class="n">List</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="block_data-16"><a href="#block_data-16"><span class="linenos">16</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="block_data-17"><a href="#block_data-17"><span class="linenos">17</span></a><span class="sd">    Generates dictionary of blocked data where each key is a block</span>
</span><span id="block_data-18"><a href="#block_data-18"><span class="linenos">18</span></a><span class="sd">    and each value is a distinct list of lists containing the data</span>
</span><span id="block_data-19"><a href="#block_data-19"><span class="linenos">19</span></a><span class="sd">    for a given block.</span>
</span><span id="block_data-20"><a href="#block_data-20"><span class="linenos">20</span></a>
</span><span id="block_data-21"><a href="#block_data-21"><span class="linenos">21</span></a><span class="sd">    :param data: A pandas dataframe of records to be linked.</span>
</span><span id="block_data-22"><a href="#block_data-22"><span class="linenos">22</span></a><span class="sd">    :param blocks: List of columns to be used in blocks.</span>
</span><span id="block_data-23"><a href="#block_data-23"><span class="linenos">23</span></a><span class="sd">    :return: A dictionary of with the keys as the blocks and the</span>
</span><span id="block_data-24"><a href="#block_data-24"><span class="linenos">24</span></a><span class="sd">      values as the data within each block, stored as a list of</span>
</span><span id="block_data-25"><a href="#block_data-25"><span class="linenos">25</span></a><span class="sd">      lists.</span>
</span><span id="block_data-26"><a href="#block_data-26"><span class="linenos">26</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="block_data-27"><a href="#block_data-27"><span class="linenos">27</span></a>    <span class="n">blocked_data_tuples</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">blocks</span><span class="p">))</span>
</span><span id="block_data-28"><a href="#block_data-28"><span class="linenos">28</span></a>
</span><span id="block_data-29"><a href="#block_data-29"><span class="linenos">29</span></a>    <span class="c1"># Convert data to list of lists within dict</span>
</span><span id="block_data-30"><a href="#block_data-30"><span class="linenos">30</span></a>    <span class="n">blocked_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="block_data-31"><a href="#block_data-31"><span class="linenos">31</span></a>    <span class="k">for</span> <span class="n">block</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">blocked_data_tuples</span><span class="p">:</span>
</span><span id="block_data-32"><a href="#block_data-32"><span class="linenos">32</span></a>        <span class="n">blocked_data</span><span class="p">[</span><span class="n">block</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="block_data-33"><a href="#block_data-33"><span class="linenos">33</span></a>
</span><span id="block_data-34"><a href="#block_data-34"><span class="linenos">34</span></a>    <span class="k">return</span> <span class="n">blocked_data</span>
</span></pre></div>


            <div class="docstring"><p>Generates dictionary of blocked data where each key is a block
and each value is a distinct list of lists containing the data
for a given block.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>data</strong>:  A pandas dataframe of records to be linked.</li>
<li><strong>blocks</strong>:  List of columns to be used in blocks.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>A dictionary of with the keys as the blocks and the
    values as the data within each block, stored as a list of
    lists.</p>
</blockquote>
</div>


                </section>
                <section id="match_within_block">
                            <input id="match_within_block-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">match_within_block</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">block</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span>,</span><span class="param">	<span class="n">feature_funcs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">]</span>,</span><span class="param">	<span class="n">match_eval</span><span class="p">:</span> <span class="n">Callable</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="match_within_block-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#match_within_block"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="match_within_block-420"><a href="#match_within_block-420"><span class="linenos">420</span></a><span class="k">def</span> <span class="nf">match_within_block</span><span class="p">(</span>
</span><span id="match_within_block-421"><a href="#match_within_block-421"><span class="linenos">421</span></a>    <span class="n">block</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">],</span>
</span><span id="match_within_block-422"><a href="#match_within_block-422"><span class="linenos">422</span></a>    <span class="n">feature_funcs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Callable</span><span class="p">],</span>
</span><span id="match_within_block-423"><a href="#match_within_block-423"><span class="linenos">423</span></a>    <span class="n">match_eval</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
</span><span id="match_within_block-424"><a href="#match_within_block-424"><span class="linenos">424</span></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="match_within_block-425"><a href="#match_within_block-425"><span class="linenos">425</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]:</span>
</span><span id="match_within_block-426"><a href="#match_within_block-426"><span class="linenos">426</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="match_within_block-427"><a href="#match_within_block-427"><span class="linenos">427</span></a><span class="sd">    Performs matching on all candidate pairs of records within a given block</span>
</span><span id="match_within_block-428"><a href="#match_within_block-428"><span class="linenos">428</span></a><span class="sd">    of data. Actual partitioning of the data should be done outside this</span>
</span><span id="match_within_block-429"><a href="#match_within_block-429"><span class="linenos">429</span></a><span class="sd">    function, as it compares all possible pairs within the provided partition.</span>
</span><span id="match_within_block-430"><a href="#match_within_block-430"><span class="linenos">430</span></a><span class="sd">    Uses a given construction of feature comparison rules as well as a</span>
</span><span id="match_within_block-431"><a href="#match_within_block-431"><span class="linenos">431</span></a><span class="sd">    match evaluation rule to determine the final verdict on whether two</span>
</span><span id="match_within_block-432"><a href="#match_within_block-432"><span class="linenos">432</span></a><span class="sd">    records are indeed a match.</span>
</span><span id="match_within_block-433"><a href="#match_within_block-433"><span class="linenos">433</span></a>
</span><span id="match_within_block-434"><a href="#match_within_block-434"><span class="linenos">434</span></a><span class="sd">    A feature function is of the form &quot;feature_match_X&quot; for some condition</span>
</span><span id="match_within_block-435"><a href="#match_within_block-435"><span class="linenos">435</span></a><span class="sd">    X; it must accept two records (lists of data), an index i in which the</span>
</span><span id="match_within_block-436"><a href="#match_within_block-436"><span class="linenos">436</span></a><span class="sd">    feature to compare is stored, and the parameter **kwargs. It must return</span>
</span><span id="match_within_block-437"><a href="#match_within_block-437"><span class="linenos">437</span></a><span class="sd">    a boolean indicating whether the features &quot;match&quot; for whatever definition</span>
</span><span id="match_within_block-438"><a href="#match_within_block-438"><span class="linenos">438</span></a><span class="sd">    of match the function uses (i.e. this allows modular logic to apply to</span>
</span><span id="match_within_block-439"><a href="#match_within_block-439"><span class="linenos">439</span></a><span class="sd">    different features in the compared records). Note that not all features</span>
</span><span id="match_within_block-440"><a href="#match_within_block-440"><span class="linenos">440</span></a><span class="sd">    in a record need a comparison function defined.</span>
</span><span id="match_within_block-441"><a href="#match_within_block-441"><span class="linenos">441</span></a>
</span><span id="match_within_block-442"><a href="#match_within_block-442"><span class="linenos">442</span></a><span class="sd">    A match evaluation rule is a function of the form &quot;eval_X&quot; for some</span>
</span><span id="match_within_block-443"><a href="#match_within_block-443"><span class="linenos">443</span></a><span class="sd">    condition X. It accepts as input a list of booleans, one for each feature</span>
</span><span id="match_within_block-444"><a href="#match_within_block-444"><span class="linenos">444</span></a><span class="sd">    that was compared with feature funcs, and determines whether the</span>
</span><span id="match_within_block-445"><a href="#match_within_block-445"><span class="linenos">445</span></a><span class="sd">    comparisons constitute a match according to X.</span>
</span><span id="match_within_block-446"><a href="#match_within_block-446"><span class="linenos">446</span></a>
</span><span id="match_within_block-447"><a href="#match_within_block-447"><span class="linenos">447</span></a><span class="sd">    :param block: A list of records to check for matches. Each record in</span>
</span><span id="match_within_block-448"><a href="#match_within_block-448"><span class="linenos">448</span></a><span class="sd">      the list is itself a list of features. The first feature of the</span>
</span><span id="match_within_block-449"><a href="#match_within_block-449"><span class="linenos">449</span></a><span class="sd">      record must be an &quot;id&quot; for the record.</span>
</span><span id="match_within_block-450"><a href="#match_within_block-450"><span class="linenos">450</span></a><span class="sd">    :param feature_funcs: A dictionary mapping feature indices to functions</span>
</span><span id="match_within_block-451"><a href="#match_within_block-451"><span class="linenos">451</span></a><span class="sd">      used to evaluate those features for a match.</span>
</span><span id="match_within_block-452"><a href="#match_within_block-452"><span class="linenos">452</span></a><span class="sd">    :param match_eval: A function for determining whether a given set of</span>
</span><span id="match_within_block-453"><a href="#match_within_block-453"><span class="linenos">453</span></a><span class="sd">      feature comparisons constitutes a match for linkage.</span>
</span><span id="match_within_block-454"><a href="#match_within_block-454"><span class="linenos">454</span></a><span class="sd">    :return: A list of 2-tuples of the form (i,j), where i,j give the indices</span>
</span><span id="match_within_block-455"><a href="#match_within_block-455"><span class="linenos">455</span></a><span class="sd">      in the block of data of records deemed to match.</span>
</span><span id="match_within_block-456"><a href="#match_within_block-456"><span class="linenos">456</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="match_within_block-457"><a href="#match_within_block-457"><span class="linenos">457</span></a>    <span class="n">match_pairs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="match_within_block-458"><a href="#match_within_block-458"><span class="linenos">458</span></a>
</span><span id="match_within_block-459"><a href="#match_within_block-459"><span class="linenos">459</span></a>    <span class="c1"># Dynamic programming table: order doesn&#39;t matter, so only need to</span>
</span><span id="match_within_block-460"><a href="#match_within_block-460"><span class="linenos">460</span></a>    <span class="c1"># check each combo of i,j once</span>
</span><span id="match_within_block-461"><a href="#match_within_block-461"><span class="linenos">461</span></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">record_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">block</span><span class="p">):</span>
</span><span id="match_within_block-462"><a href="#match_within_block-462"><span class="linenos">462</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="p">)):</span>
</span><span id="match_within_block-463"><a href="#match_within_block-463"><span class="linenos">463</span></a>            <span class="n">record_j</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="match_within_block-464"><a href="#match_within_block-464"><span class="linenos">464</span></a>            <span class="n">feature_comps</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="match_within_block-465"><a href="#match_within_block-465"><span class="linenos">465</span></a>                <span class="n">feature_funcs</span><span class="p">[</span><span class="n">x</span><span class="p">](</span><span class="n">record_i</span><span class="p">,</span> <span class="n">record_j</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="match_within_block-466"><a href="#match_within_block-466"><span class="linenos">466</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">record_i</span><span class="p">))</span>
</span><span id="match_within_block-467"><a href="#match_within_block-467"><span class="linenos">467</span></a>                <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">feature_funcs</span>
</span><span id="match_within_block-468"><a href="#match_within_block-468"><span class="linenos">468</span></a>            <span class="p">]</span>
</span><span id="match_within_block-469"><a href="#match_within_block-469"><span class="linenos">469</span></a>
</span><span id="match_within_block-470"><a href="#match_within_block-470"><span class="linenos">470</span></a>            <span class="c1"># If it&#39;s a match, store the result</span>
</span><span id="match_within_block-471"><a href="#match_within_block-471"><span class="linenos">471</span></a>            <span class="n">is_match</span> <span class="o">=</span> <span class="n">match_eval</span><span class="p">(</span><span class="n">feature_comps</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="match_within_block-472"><a href="#match_within_block-472"><span class="linenos">472</span></a>            <span class="k">if</span> <span class="n">is_match</span><span class="p">:</span>
</span><span id="match_within_block-473"><a href="#match_within_block-473"><span class="linenos">473</span></a>                <span class="n">match_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
</span><span id="match_within_block-474"><a href="#match_within_block-474"><span class="linenos">474</span></a>
</span><span id="match_within_block-475"><a href="#match_within_block-475"><span class="linenos">475</span></a>    <span class="k">return</span> <span class="n">match_pairs</span>
</span></pre></div>


            <div class="docstring"><p>Performs matching on all candidate pairs of records within a given block
of data. Actual partitioning of the data should be done outside this
function, as it compares all possible pairs within the provided partition.
Uses a given construction of feature comparison rules as well as a
match evaluation rule to determine the final verdict on whether two
records are indeed a match.</p>

<p>A feature function is of the form "feature_match_X" for some condition
X; it must accept two records (lists of data), an index i in which the
feature to compare is stored, and the parameter **kwargs. It must return
a boolean indicating whether the features "match" for whatever definition
of match the function uses (i.e. this allows modular logic to apply to
different features in the compared records). Note that not all features
in a record need a comparison function defined.</p>

<p>A match evaluation rule is a function of the form "eval_X" for some
condition X. It accepts as input a list of booleans, one for each feature
that was compared with feature funcs, and determines whether the
comparisons constitute a match according to X.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>block</strong>:  A list of records to check for matches. Each record in
the list is itself a list of features. The first feature of the
record must be an "id" for the record.</li>
<li><strong>feature_funcs</strong>:  A dictionary mapping feature indices to functions
used to evaluate those features for a match.</li>
<li><strong>match_eval</strong>:  A function for determining whether a given set of
feature comparisons constitutes a match for linkage.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>A list of 2-tuples of the form (i,j), where i,j give the indices
    in the block of data of records deemed to match.</p>
</blockquote>
</div>


                </section>
                <section id="feature_match_exact">
                            <input id="feature_match_exact-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">feature_match_exact</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">record_i</span><span class="p">:</span> <span class="n">List</span>, </span><span class="param"><span class="n">record_j</span><span class="p">:</span> <span class="n">List</span>, </span><span class="param"><span class="n">feature_x</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="feature_match_exact-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#feature_match_exact"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="feature_match_exact-251"><a href="#feature_match_exact-251"><span class="linenos">251</span></a><span class="k">def</span> <span class="nf">feature_match_exact</span><span class="p">(</span>
</span><span id="feature_match_exact-252"><a href="#feature_match_exact-252"><span class="linenos">252</span></a>    <span class="n">record_i</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">record_j</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">feature_x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span>
</span><span id="feature_match_exact-253"><a href="#feature_match_exact-253"><span class="linenos">253</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="feature_match_exact-254"><a href="#feature_match_exact-254"><span class="linenos">254</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="feature_match_exact-255"><a href="#feature_match_exact-255"><span class="linenos">255</span></a><span class="sd">    Determines whether a single feature in a given pair of records</span>
</span><span id="feature_match_exact-256"><a href="#feature_match_exact-256"><span class="linenos">256</span></a><span class="sd">    constitutes an exact match (perfect equality).</span>
</span><span id="feature_match_exact-257"><a href="#feature_match_exact-257"><span class="linenos">257</span></a>
</span><span id="feature_match_exact-258"><a href="#feature_match_exact-258"><span class="linenos">258</span></a><span class="sd">    :param record_i: One of the records in the candidate pair to evaluate.</span>
</span><span id="feature_match_exact-259"><a href="#feature_match_exact-259"><span class="linenos">259</span></a><span class="sd">    :param record_j: The second record in the candidate pair.</span>
</span><span id="feature_match_exact-260"><a href="#feature_match_exact-260"><span class="linenos">260</span></a><span class="sd">    :param feature_x: A number representing the index of the feature to</span>
</span><span id="feature_match_exact-261"><a href="#feature_match_exact-261"><span class="linenos">261</span></a><span class="sd">      compare for equality.</span>
</span><span id="feature_match_exact-262"><a href="#feature_match_exact-262"><span class="linenos">262</span></a><span class="sd">    :return: A boolean indicating whether the features are an exact match.</span>
</span><span id="feature_match_exact-263"><a href="#feature_match_exact-263"><span class="linenos">263</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="feature_match_exact-264"><a href="#feature_match_exact-264"><span class="linenos">264</span></a>    <span class="k">return</span> <span class="n">record_i</span><span class="p">[</span><span class="n">feature_x</span><span class="p">]</span> <span class="o">==</span> <span class="n">record_j</span><span class="p">[</span><span class="n">feature_x</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Determines whether a single feature in a given pair of records
constitutes an exact match (perfect equality).</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>record_i</strong>:  One of the records in the candidate pair to evaluate.</li>
<li><strong>record_j</strong>:  The second record in the candidate pair.</li>
<li><strong>feature_x</strong>:  A number representing the index of the feature to
compare for equality.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>A boolean indicating whether the features are an exact match.</p>
</blockquote>
</div>


                </section>
                <section id="feature_match_fuzzy_string">
                            <input id="feature_match_fuzzy_string-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">feature_match_fuzzy_string</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">record_i</span><span class="p">:</span> <span class="n">List</span>, </span><span class="param"><span class="n">record_j</span><span class="p">:</span> <span class="n">List</span>, </span><span class="param"><span class="n">feature_x</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="feature_match_fuzzy_string-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#feature_match_fuzzy_string"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="feature_match_fuzzy_string-285"><a href="#feature_match_fuzzy_string-285"><span class="linenos">285</span></a><span class="k">def</span> <span class="nf">feature_match_fuzzy_string</span><span class="p">(</span>
</span><span id="feature_match_fuzzy_string-286"><a href="#feature_match_fuzzy_string-286"><span class="linenos">286</span></a>    <span class="n">record_i</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">record_j</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">feature_x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span>
</span><span id="feature_match_fuzzy_string-287"><a href="#feature_match_fuzzy_string-287"><span class="linenos">287</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="feature_match_fuzzy_string-288"><a href="#feature_match_fuzzy_string-288"><span class="linenos">288</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="feature_match_fuzzy_string-289"><a href="#feature_match_fuzzy_string-289"><span class="linenos">289</span></a><span class="sd">    Determines whether two strings in a given pair of records are close</span>
</span><span id="feature_match_fuzzy_string-290"><a href="#feature_match_fuzzy_string-290"><span class="linenos">290</span></a><span class="sd">    enough to constitute a partial match. The exact nature of the match</span>
</span><span id="feature_match_fuzzy_string-291"><a href="#feature_match_fuzzy_string-291"><span class="linenos">291</span></a><span class="sd">    is determined by the specified string comparison function (see</span>
</span><span id="feature_match_fuzzy_string-292"><a href="#feature_match_fuzzy_string-292"><span class="linenos">292</span></a><span class="sd">    harmonization/utils/compare_strings for more details) as well as a</span>
</span><span id="feature_match_fuzzy_string-293"><a href="#feature_match_fuzzy_string-293"><span class="linenos">293</span></a><span class="sd">    scoring threshold the comparison must meet or exceed.</span>
</span><span id="feature_match_fuzzy_string-294"><a href="#feature_match_fuzzy_string-294"><span class="linenos">294</span></a>
</span><span id="feature_match_fuzzy_string-295"><a href="#feature_match_fuzzy_string-295"><span class="linenos">295</span></a><span class="sd">    :param record_i: One of the records in the candidate pair to evaluate.</span>
</span><span id="feature_match_fuzzy_string-296"><a href="#feature_match_fuzzy_string-296"><span class="linenos">296</span></a><span class="sd">    :param record_j: The second record in the candidate pair.</span>
</span><span id="feature_match_fuzzy_string-297"><a href="#feature_match_fuzzy_string-297"><span class="linenos">297</span></a><span class="sd">    :param feature_x: A number representing the index of the feature to</span>
</span><span id="feature_match_fuzzy_string-298"><a href="#feature_match_fuzzy_string-298"><span class="linenos">298</span></a><span class="sd">      compare for a partial match.</span>
</span><span id="feature_match_fuzzy_string-299"><a href="#feature_match_fuzzy_string-299"><span class="linenos">299</span></a><span class="sd">    :param **kwargs: Optionally, a dictionary including specifications for</span>
</span><span id="feature_match_fuzzy_string-300"><a href="#feature_match_fuzzy_string-300"><span class="linenos">300</span></a><span class="sd">      the string comparison metric to use, as well as the cutoff score</span>
</span><span id="feature_match_fuzzy_string-301"><a href="#feature_match_fuzzy_string-301"><span class="linenos">301</span></a><span class="sd">      beyond which to classify the strings as a partial match.</span>
</span><span id="feature_match_fuzzy_string-302"><a href="#feature_match_fuzzy_string-302"><span class="linenos">302</span></a><span class="sd">    :return: A boolean indicating whether the features are a fuzzy match.</span>
</span><span id="feature_match_fuzzy_string-303"><a href="#feature_match_fuzzy_string-303"><span class="linenos">303</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="feature_match_fuzzy_string-304"><a href="#feature_match_fuzzy_string-304"><span class="linenos">304</span></a>    <span class="c1"># Special case for two empty strings, since we don&#39;t want vacuous</span>
</span><span id="feature_match_fuzzy_string-305"><a href="#feature_match_fuzzy_string-305"><span class="linenos">305</span></a>    <span class="c1"># equality (or in-) to penalize the score</span>
</span><span id="feature_match_fuzzy_string-306"><a href="#feature_match_fuzzy_string-306"><span class="linenos">306</span></a>    <span class="k">if</span> <span class="n">record_i</span><span class="p">[</span><span class="n">feature_x</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">record_j</span><span class="p">[</span><span class="n">feature_x</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="feature_match_fuzzy_string-307"><a href="#feature_match_fuzzy_string-307"><span class="linenos">307</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="feature_match_fuzzy_string-308"><a href="#feature_match_fuzzy_string-308"><span class="linenos">308</span></a>    <span class="k">if</span> <span class="n">record_i</span><span class="p">[</span><span class="n">feature_x</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">record_j</span><span class="p">[</span><span class="n">feature_x</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="feature_match_fuzzy_string-309"><a href="#feature_match_fuzzy_string-309"><span class="linenos">309</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="feature_match_fuzzy_string-310"><a href="#feature_match_fuzzy_string-310"><span class="linenos">310</span></a>
</span><span id="feature_match_fuzzy_string-311"><a href="#feature_match_fuzzy_string-311"><span class="linenos">311</span></a>    <span class="n">similarity_measure</span> <span class="o">=</span> <span class="s2">&quot;JaroWinkler&quot;</span>
</span><span id="feature_match_fuzzy_string-312"><a href="#feature_match_fuzzy_string-312"><span class="linenos">312</span></a>    <span class="k">if</span> <span class="s2">&quot;similarity_measure&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="feature_match_fuzzy_string-313"><a href="#feature_match_fuzzy_string-313"><span class="linenos">313</span></a>        <span class="n">similarity_measure</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;similarity_measure&quot;</span><span class="p">]</span>
</span><span id="feature_match_fuzzy_string-314"><a href="#feature_match_fuzzy_string-314"><span class="linenos">314</span></a>    <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.7</span>
</span><span id="feature_match_fuzzy_string-315"><a href="#feature_match_fuzzy_string-315"><span class="linenos">315</span></a>    <span class="k">if</span> <span class="s2">&quot;threshold&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="feature_match_fuzzy_string-316"><a href="#feature_match_fuzzy_string-316"><span class="linenos">316</span></a>        <span class="n">threshold</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;threshold&quot;</span><span class="p">]</span>
</span><span id="feature_match_fuzzy_string-317"><a href="#feature_match_fuzzy_string-317"><span class="linenos">317</span></a>    <span class="n">score</span> <span class="o">=</span> <span class="n">compare_strings</span><span class="p">(</span>
</span><span id="feature_match_fuzzy_string-318"><a href="#feature_match_fuzzy_string-318"><span class="linenos">318</span></a>        <span class="n">record_i</span><span class="p">[</span><span class="n">feature_x</span><span class="p">],</span> <span class="n">record_j</span><span class="p">[</span><span class="n">feature_x</span><span class="p">],</span> <span class="n">similarity_measure</span>
</span><span id="feature_match_fuzzy_string-319"><a href="#feature_match_fuzzy_string-319"><span class="linenos">319</span></a>    <span class="p">)</span>
</span><span id="feature_match_fuzzy_string-320"><a href="#feature_match_fuzzy_string-320"><span class="linenos">320</span></a>    <span class="k">return</span> <span class="n">score</span> <span class="o">&gt;=</span> <span class="n">threshold</span>
</span></pre></div>


            <div class="docstring"><p>Determines whether two strings in a given pair of records are close
enough to constitute a partial match. The exact nature of the match
is determined by the specified string comparison function (see
harmonization/utils/compare_strings for more details) as well as a
scoring threshold the comparison must meet or exceed.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>record_i</strong>:  One of the records in the candidate pair to evaluate.</li>
<li><strong>record_j</strong>:  The second record in the candidate pair.</li>
<li><strong>feature_x</strong>:  A number representing the index of the feature to
compare for a partial match.</li>
<li><strong>**kwargs</strong>:  Optionally, a dictionary including specifications for
the string comparison metric to use, as well as the cutoff score
beyond which to classify the strings as a partial match.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>A boolean indicating whether the features are a fuzzy match.</p>
</blockquote>
</div>


                </section>
                <section id="eval_perfect_match">
                            <input id="eval_perfect_match-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">eval_perfect_match</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">feature_comparisons</span><span class="p">:</span> <span class="n">List</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="eval_perfect_match-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#eval_perfect_match"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="eval_perfect_match-222"><a href="#eval_perfect_match-222"><span class="linenos">222</span></a><span class="k">def</span> <span class="nf">eval_perfect_match</span><span class="p">(</span><span class="n">feature_comparisons</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="eval_perfect_match-223"><a href="#eval_perfect_match-223"><span class="linenos">223</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="eval_perfect_match-224"><a href="#eval_perfect_match-224"><span class="linenos">224</span></a><span class="sd">    Determines whether a given set of feature comparisons represent a</span>
</span><span id="eval_perfect_match-225"><a href="#eval_perfect_match-225"><span class="linenos">225</span></a><span class="sd">    &#39;perfect&#39; match (i.e. whether all features that were compared match</span>
</span><span id="eval_perfect_match-226"><a href="#eval_perfect_match-226"><span class="linenos">226</span></a><span class="sd">    in whatever criteria was specified for them).</span>
</span><span id="eval_perfect_match-227"><a href="#eval_perfect_match-227"><span class="linenos">227</span></a>
</span><span id="eval_perfect_match-228"><a href="#eval_perfect_match-228"><span class="linenos">228</span></a><span class="sd">    :param feature_comparisons: A list of 1s and 0s, one for each feature</span>
</span><span id="eval_perfect_match-229"><a href="#eval_perfect_match-229"><span class="linenos">229</span></a><span class="sd">      that was compared during the match algorithm.</span>
</span><span id="eval_perfect_match-230"><a href="#eval_perfect_match-230"><span class="linenos">230</span></a><span class="sd">    :return: The evaluation of whether the given features all match.</span>
</span><span id="eval_perfect_match-231"><a href="#eval_perfect_match-231"><span class="linenos">231</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="eval_perfect_match-232"><a href="#eval_perfect_match-232"><span class="linenos">232</span></a>    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">feature_comparisons</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_comparisons</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Determines whether a given set of feature comparisons represent a
'perfect' match (i.e. whether all features that were compared match
in whatever criteria was specified for them).</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>feature_comparisons</strong>:  A list of 1s and 0s, one for each feature
that was compared during the match algorithm.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The evaluation of whether the given features all match.</p>
</blockquote>
</div>


                </section>
                <section id="compile_match_lists">
                            <input id="compile_match_lists-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compile_match_lists</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">match_lists</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>, </span><span class="param"><span class="n">cluster_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="compile_match_lists-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#compile_match_lists"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="compile_match_lists-184"><a href="#compile_match_lists-184"><span class="linenos">184</span></a><span class="k">def</span> <span class="nf">compile_match_lists</span><span class="p">(</span><span class="n">match_lists</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">cluster_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="compile_match_lists-185"><a href="#compile_match_lists-185"><span class="linenos">185</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="compile_match_lists-186"><a href="#compile_match_lists-186"><span class="linenos">186</span></a><span class="sd">    Turns a list of matches of either clusters or candidate pairs found</span>
</span><span id="compile_match_lists-187"><a href="#compile_match_lists-187"><span class="linenos">187</span></a><span class="sd">    during linkage into a single unified structure holding all found matches</span>
</span><span id="compile_match_lists-188"><a href="#compile_match_lists-188"><span class="linenos">188</span></a><span class="sd">    across all rules passes. E.g. if a single pass of a linkage algorithm</span>
</span><span id="compile_match_lists-189"><a href="#compile_match_lists-189"><span class="linenos">189</span></a><span class="sd">    uses three rules, hence generates three dictionaries of matches, this</span>
</span><span id="compile_match_lists-190"><a href="#compile_match_lists-190"><span class="linenos">190</span></a><span class="sd">    function will aggregate the results of those three separate dicts into</span>
</span><span id="compile_match_lists-191"><a href="#compile_match_lists-191"><span class="linenos">191</span></a><span class="sd">    a single unified and deduplicated dictionary. For consistency during</span>
</span><span id="compile_match_lists-192"><a href="#compile_match_lists-192"><span class="linenos">192</span></a><span class="sd">    statistical evaluation, the returned dictionary is always indexed by</span>
</span><span id="compile_match_lists-193"><a href="#compile_match_lists-193"><span class="linenos">193</span></a><span class="sd">    the lower ID of the records in a given pair.</span>
</span><span id="compile_match_lists-194"><a href="#compile_match_lists-194"><span class="linenos">194</span></a>
</span><span id="compile_match_lists-195"><a href="#compile_match_lists-195"><span class="linenos">195</span></a><span class="sd">    :param match_lists: A list of the dictionaries obtained during a run</span>
</span><span id="compile_match_lists-196"><a href="#compile_match_lists-196"><span class="linenos">196</span></a><span class="sd">      of the linkage algorithm, one dictionary per rule used in the run.</span>
</span><span id="compile_match_lists-197"><a href="#compile_match_lists-197"><span class="linenos">197</span></a><span class="sd">    :param cluster_mode: An optional boolean indicating whether the linkage</span>
</span><span id="compile_match_lists-198"><a href="#compile_match_lists-198"><span class="linenos">198</span></a><span class="sd">      algorithm was run in cluster mode. Default is False.</span>
</span><span id="compile_match_lists-199"><a href="#compile_match_lists-199"><span class="linenos">199</span></a><span class="sd">    :return: The aggregated dictionary of unified matches.</span>
</span><span id="compile_match_lists-200"><a href="#compile_match_lists-200"><span class="linenos">200</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="compile_match_lists-201"><a href="#compile_match_lists-201"><span class="linenos">201</span></a>    <span class="n">matches</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="compile_match_lists-202"><a href="#compile_match_lists-202"><span class="linenos">202</span></a>    <span class="k">for</span> <span class="n">matches_from_rule</span> <span class="ow">in</span> <span class="n">match_lists</span><span class="p">:</span>
</span><span id="compile_match_lists-203"><a href="#compile_match_lists-203"><span class="linenos">203</span></a>        <span class="k">for</span> <span class="n">matches_within_blocks</span> <span class="ow">in</span> <span class="n">matches_from_rule</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="compile_match_lists-204"><a href="#compile_match_lists-204"><span class="linenos">204</span></a>            <span class="k">for</span> <span class="n">candidate_set</span> <span class="ow">in</span> <span class="n">matches_within_blocks</span><span class="p">:</span>
</span><span id="compile_match_lists-205"><a href="#compile_match_lists-205"><span class="linenos">205</span></a>                <span class="c1"># Always index the aggregate by the lowest valued ID</span>
</span><span id="compile_match_lists-206"><a href="#compile_match_lists-206"><span class="linenos">206</span></a>                <span class="c1"># for statistical consistency and deduplication</span>
</span><span id="compile_match_lists-207"><a href="#compile_match_lists-207"><span class="linenos">207</span></a>                <span class="n">root_record</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">candidate_set</span><span class="p">)</span>
</span><span id="compile_match_lists-208"><a href="#compile_match_lists-208"><span class="linenos">208</span></a>                <span class="k">if</span> <span class="n">root_record</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
</span><span id="compile_match_lists-209"><a href="#compile_match_lists-209"><span class="linenos">209</span></a>                    <span class="n">matches</span><span class="p">[</span><span class="n">root_record</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="compile_match_lists-210"><a href="#compile_match_lists-210"><span class="linenos">210</span></a>
</span><span id="compile_match_lists-211"><a href="#compile_match_lists-211"><span class="linenos">211</span></a>                <span class="c1"># For clustering, need to add all other records in the cluster</span>
</span><span id="compile_match_lists-212"><a href="#compile_match_lists-212"><span class="linenos">212</span></a>                <span class="k">if</span> <span class="n">cluster_mode</span><span class="p">:</span>
</span><span id="compile_match_lists-213"><a href="#compile_match_lists-213"><span class="linenos">213</span></a>                    <span class="k">for</span> <span class="n">clustered_record</span> <span class="ow">in</span> <span class="n">candidate_set</span><span class="p">:</span>
</span><span id="compile_match_lists-214"><a href="#compile_match_lists-214"><span class="linenos">214</span></a>                        <span class="k">if</span> <span class="n">clustered_record</span> <span class="o">!=</span> <span class="n">root_record</span><span class="p">:</span>
</span><span id="compile_match_lists-215"><a href="#compile_match_lists-215"><span class="linenos">215</span></a>                            <span class="n">matches</span><span class="p">[</span><span class="n">root_record</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">clustered_record</span><span class="p">)</span>
</span><span id="compile_match_lists-216"><a href="#compile_match_lists-216"><span class="linenos">216</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="compile_match_lists-217"><a href="#compile_match_lists-217"><span class="linenos">217</span></a>                    <span class="n">matched_record</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">candidate_set</span><span class="p">)</span>
</span><span id="compile_match_lists-218"><a href="#compile_match_lists-218"><span class="linenos">218</span></a>                    <span class="n">matches</span><span class="p">[</span><span class="n">root_record</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">matched_record</span><span class="p">)</span>
</span><span id="compile_match_lists-219"><a href="#compile_match_lists-219"><span class="linenos">219</span></a>    <span class="k">return</span> <span class="n">matches</span>
</span></pre></div>


            <div class="docstring"><p>Turns a list of matches of either clusters or candidate pairs found
during linkage into a single unified structure holding all found matches
across all rules passes. E.g. if a single pass of a linkage algorithm
uses three rules, hence generates three dictionaries of matches, this
function will aggregate the results of those three separate dicts into
a single unified and deduplicated dictionary. For consistency during
statistical evaluation, the returned dictionary is always indexed by
the lower ID of the records in a given pair.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>match_lists</strong>:  A list of the dictionaries obtained during a run
of the linkage algorithm, one dictionary per rule used in the run.</li>
<li><strong>cluster_mode</strong>:  An optional boolean indicating whether the linkage
algorithm was run in cluster mode. Default is False.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The aggregated dictionary of unified matches.</p>
</blockquote>
</div>


                </section>
                <section id="feature_match_four_char">
                            <input id="feature_match_four_char-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">feature_match_four_char</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">record_i</span><span class="p">:</span> <span class="n">List</span>, </span><span class="param"><span class="n">record_j</span><span class="p">:</span> <span class="n">List</span>, </span><span class="param"><span class="n">feature_x</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="feature_match_four_char-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#feature_match_four_char"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="feature_match_four_char-267"><a href="#feature_match_four_char-267"><span class="linenos">267</span></a><span class="k">def</span> <span class="nf">feature_match_four_char</span><span class="p">(</span>
</span><span id="feature_match_four_char-268"><a href="#feature_match_four_char-268"><span class="linenos">268</span></a>    <span class="n">record_i</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">record_j</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">feature_x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span>
</span><span id="feature_match_four_char-269"><a href="#feature_match_four_char-269"><span class="linenos">269</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="feature_match_four_char-270"><a href="#feature_match_four_char-270"><span class="linenos">270</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="feature_match_four_char-271"><a href="#feature_match_four_char-271"><span class="linenos">271</span></a><span class="sd">    Determines whether a string feature in a pair of records exactly matches</span>
</span><span id="feature_match_four_char-272"><a href="#feature_match_four_char-272"><span class="linenos">272</span></a><span class="sd">    on the first four characters.</span>
</span><span id="feature_match_four_char-273"><a href="#feature_match_four_char-273"><span class="linenos">273</span></a>
</span><span id="feature_match_four_char-274"><a href="#feature_match_four_char-274"><span class="linenos">274</span></a><span class="sd">    :param record_i: One of the records in the candidate pair to evaluate.</span>
</span><span id="feature_match_four_char-275"><a href="#feature_match_four_char-275"><span class="linenos">275</span></a><span class="sd">    :param record_j: The second record in the candidate pair.</span>
</span><span id="feature_match_four_char-276"><a href="#feature_match_four_char-276"><span class="linenos">276</span></a><span class="sd">    :param feature_x: A number representing the index of the feature to</span>
</span><span id="feature_match_four_char-277"><a href="#feature_match_four_char-277"><span class="linenos">277</span></a><span class="sd">      compare.</span>
</span><span id="feature_match_four_char-278"><a href="#feature_match_four_char-278"><span class="linenos">278</span></a><span class="sd">    :return: A boolean indicating whether the features are a match.</span>
</span><span id="feature_match_four_char-279"><a href="#feature_match_four_char-279"><span class="linenos">279</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="feature_match_four_char-280"><a href="#feature_match_four_char-280"><span class="linenos">280</span></a>    <span class="n">first_four_i</span> <span class="o">=</span> <span class="n">record_i</span><span class="p">[</span><span class="n">feature_x</span><span class="p">][:</span> <span class="nb">min</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">record_i</span><span class="p">[</span><span class="n">feature_x</span><span class="p">]))]</span>
</span><span id="feature_match_four_char-281"><a href="#feature_match_four_char-281"><span class="linenos">281</span></a>    <span class="n">first_four_j</span> <span class="o">=</span> <span class="n">record_j</span><span class="p">[</span><span class="n">feature_x</span><span class="p">][:</span> <span class="nb">min</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">record_j</span><span class="p">[</span><span class="n">feature_x</span><span class="p">]))]</span>
</span><span id="feature_match_four_char-282"><a href="#feature_match_four_char-282"><span class="linenos">282</span></a>    <span class="k">return</span> <span class="n">first_four_i</span> <span class="o">==</span> <span class="n">first_four_j</span>
</span></pre></div>


            <div class="docstring"><p>Determines whether a string feature in a pair of records exactly matches
on the first four characters.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>record_i</strong>:  One of the records in the candidate pair to evaluate.</li>
<li><strong>record_j</strong>:  The second record in the candidate pair.</li>
<li><strong>feature_x</strong>:  A number representing the index of the feature to
compare.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>A boolean indicating whether the features are a match.</p>
</blockquote>
</div>


                </section>
                <section id="perform_linkage_pass">
                            <input id="perform_linkage_pass-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">perform_linkage_pass</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	<span class="n">blocks</span><span class="p">:</span> <span class="n">List</span>,</span><span class="param">	<span class="n">feature_funcs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">]</span>,</span><span class="param">	<span class="n">matching_rule</span><span class="p">:</span> <span class="n">Callable</span>,</span><span class="param">	<span class="n">cluster_ratio</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="perform_linkage_pass-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#perform_linkage_pass"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="perform_linkage_pass-482"><a href="#perform_linkage_pass-482"><span class="linenos">482</span></a><span class="k">def</span> <span class="nf">perform_linkage_pass</span><span class="p">(</span>
</span><span id="perform_linkage_pass-483"><a href="#perform_linkage_pass-483"><span class="linenos">483</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="perform_linkage_pass-484"><a href="#perform_linkage_pass-484"><span class="linenos">484</span></a>    <span class="n">blocks</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="perform_linkage_pass-485"><a href="#perform_linkage_pass-485"><span class="linenos">485</span></a>    <span class="n">feature_funcs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Callable</span><span class="p">],</span>
</span><span id="perform_linkage_pass-486"><a href="#perform_linkage_pass-486"><span class="linenos">486</span></a>    <span class="n">matching_rule</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
</span><span id="perform_linkage_pass-487"><a href="#perform_linkage_pass-487"><span class="linenos">487</span></a>    <span class="n">cluster_ratio</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="perform_linkage_pass-488"><a href="#perform_linkage_pass-488"><span class="linenos">488</span></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="perform_linkage_pass-489"><a href="#perform_linkage_pass-489"><span class="linenos">489</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="perform_linkage_pass-490"><a href="#perform_linkage_pass-490"><span class="linenos">490</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="perform_linkage_pass-491"><a href="#perform_linkage_pass-491"><span class="linenos">491</span></a><span class="sd">    Performs a partial run of a linkage algorithm using a single rule.</span>
</span><span id="perform_linkage_pass-492"><a href="#perform_linkage_pass-492"><span class="linenos">492</span></a><span class="sd">    Each rule in an algorithm is associated with its own pass through the</span>
</span><span id="perform_linkage_pass-493"><a href="#perform_linkage_pass-493"><span class="linenos">493</span></a><span class="sd">    data.</span>
</span><span id="perform_linkage_pass-494"><a href="#perform_linkage_pass-494"><span class="linenos">494</span></a>
</span><span id="perform_linkage_pass-495"><a href="#perform_linkage_pass-495"><span class="linenos">495</span></a><span class="sd">    :param data: Currently, a pandas dataframe of records to link. When we</span>
</span><span id="perform_linkage_pass-496"><a href="#perform_linkage_pass-496"><span class="linenos">496</span></a><span class="sd">      move out of testing, this should become a LoL.</span>
</span><span id="perform_linkage_pass-497"><a href="#perform_linkage_pass-497"><span class="linenos">497</span></a><span class="sd">    :param blocks: A list of column headers to use as blocking assignments</span>
</span><span id="perform_linkage_pass-498"><a href="#perform_linkage_pass-498"><span class="linenos">498</span></a><span class="sd">      by which to partition the data.</span>
</span><span id="perform_linkage_pass-499"><a href="#perform_linkage_pass-499"><span class="linenos">499</span></a><span class="sd">    :param feature_funcs: A dictionary mapping feature indices to functions</span>
</span><span id="perform_linkage_pass-500"><a href="#perform_linkage_pass-500"><span class="linenos">500</span></a><span class="sd">      used to evaluate those features for a match.</span>
</span><span id="perform_linkage_pass-501"><a href="#perform_linkage_pass-501"><span class="linenos">501</span></a><span class="sd">    :param matching_rule: A function for determining whether a given set of</span>
</span><span id="perform_linkage_pass-502"><a href="#perform_linkage_pass-502"><span class="linenos">502</span></a><span class="sd">      feature comparisons constitutes a match for linkage.</span>
</span><span id="perform_linkage_pass-503"><a href="#perform_linkage_pass-503"><span class="linenos">503</span></a><span class="sd">    :param cluster_ratio: An optional parameter indicating, if using the</span>
</span><span id="perform_linkage_pass-504"><a href="#perform_linkage_pass-504"><span class="linenos">504</span></a><span class="sd">      algorithm in cluster mode, the required membership percentage a record</span>
</span><span id="perform_linkage_pass-505"><a href="#perform_linkage_pass-505"><span class="linenos">505</span></a><span class="sd">      must score with an existing cluster in order to join.</span>
</span><span id="perform_linkage_pass-506"><a href="#perform_linkage_pass-506"><span class="linenos">506</span></a><span class="sd">    :return: A dictionary mapping each block found in the pass to the matches</span>
</span><span id="perform_linkage_pass-507"><a href="#perform_linkage_pass-507"><span class="linenos">507</span></a><span class="sd">      discovered within that block.</span>
</span><span id="perform_linkage_pass-508"><a href="#perform_linkage_pass-508"><span class="linenos">508</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="perform_linkage_pass-509"><a href="#perform_linkage_pass-509"><span class="linenos">509</span></a>    <span class="n">blocked_data</span> <span class="o">=</span> <span class="n">block_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">blocks</span><span class="p">)</span>
</span><span id="perform_linkage_pass-510"><a href="#perform_linkage_pass-510"><span class="linenos">510</span></a>    <span class="n">matches</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="perform_linkage_pass-511"><a href="#perform_linkage_pass-511"><span class="linenos">511</span></a>    <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">blocked_data</span><span class="p">:</span>
</span><span id="perform_linkage_pass-512"><a href="#perform_linkage_pass-512"><span class="linenos">512</span></a>        <span class="k">if</span> <span class="n">cluster_ratio</span><span class="p">:</span>
</span><span id="perform_linkage_pass-513"><a href="#perform_linkage_pass-513"><span class="linenos">513</span></a>            <span class="n">matches_in_block</span> <span class="o">=</span> <span class="n">_match_within_block_cluster_ratio</span><span class="p">(</span>
</span><span id="perform_linkage_pass-514"><a href="#perform_linkage_pass-514"><span class="linenos">514</span></a>                <span class="n">blocked_data</span><span class="p">[</span><span class="n">block</span><span class="p">],</span>
</span><span id="perform_linkage_pass-515"><a href="#perform_linkage_pass-515"><span class="linenos">515</span></a>                <span class="n">cluster_ratio</span><span class="p">,</span>
</span><span id="perform_linkage_pass-516"><a href="#perform_linkage_pass-516"><span class="linenos">516</span></a>                <span class="n">feature_funcs</span><span class="p">,</span>
</span><span id="perform_linkage_pass-517"><a href="#perform_linkage_pass-517"><span class="linenos">517</span></a>                <span class="n">matching_rule</span><span class="p">,</span>
</span><span id="perform_linkage_pass-518"><a href="#perform_linkage_pass-518"><span class="linenos">518</span></a>                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="perform_linkage_pass-519"><a href="#perform_linkage_pass-519"><span class="linenos">519</span></a>            <span class="p">)</span>
</span><span id="perform_linkage_pass-520"><a href="#perform_linkage_pass-520"><span class="linenos">520</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="perform_linkage_pass-521"><a href="#perform_linkage_pass-521"><span class="linenos">521</span></a>            <span class="n">matches_in_block</span> <span class="o">=</span> <span class="n">match_within_block</span><span class="p">(</span>
</span><span id="perform_linkage_pass-522"><a href="#perform_linkage_pass-522"><span class="linenos">522</span></a>                <span class="n">blocked_data</span><span class="p">[</span><span class="n">block</span><span class="p">],</span> <span class="n">feature_funcs</span><span class="p">,</span> <span class="n">matching_rule</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
</span><span id="perform_linkage_pass-523"><a href="#perform_linkage_pass-523"><span class="linenos">523</span></a>            <span class="p">)</span>
</span><span id="perform_linkage_pass-524"><a href="#perform_linkage_pass-524"><span class="linenos">524</span></a>        <span class="n">matches_in_block</span> <span class="o">=</span> <span class="n">_map_matches_to_record_ids</span><span class="p">(</span>
</span><span id="perform_linkage_pass-525"><a href="#perform_linkage_pass-525"><span class="linenos">525</span></a>            <span class="n">matches_in_block</span><span class="p">,</span> <span class="n">blocked_data</span><span class="p">[</span><span class="n">block</span><span class="p">],</span> <span class="n">cluster_ratio</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="perform_linkage_pass-526"><a href="#perform_linkage_pass-526"><span class="linenos">526</span></a>        <span class="p">)</span>
</span><span id="perform_linkage_pass-527"><a href="#perform_linkage_pass-527"><span class="linenos">527</span></a>        <span class="n">matches</span><span class="p">[</span><span class="n">block</span><span class="p">]</span> <span class="o">=</span> <span class="n">matches_in_block</span>
</span><span id="perform_linkage_pass-528"><a href="#perform_linkage_pass-528"><span class="linenos">528</span></a>    <span class="k">return</span> <span class="n">matches</span>
</span></pre></div>


            <div class="docstring"><p>Performs a partial run of a linkage algorithm using a single rule.
Each rule in an algorithm is associated with its own pass through the
data.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>data</strong>:  Currently, a pandas dataframe of records to link. When we
move out of testing, this should become a LoL.</li>
<li><strong>blocks</strong>:  A list of column headers to use as blocking assignments
by which to partition the data.</li>
<li><strong>feature_funcs</strong>:  A dictionary mapping feature indices to functions
used to evaluate those features for a match.</li>
<li><strong>matching_rule</strong>:  A function for determining whether a given set of
feature comparisons constitutes a match for linkage.</li>
<li><strong>cluster_ratio</strong>:  An optional parameter indicating, if using the
algorithm in cluster mode, the required membership percentage a record
must score with an existing cluster in order to join.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>A dictionary mapping each block found in the pass to the matches
    discovered within that block.</p>
</blockquote>
</div>


                </section>
                <section id="score_linkage_vs_truth">
                            <input id="score_linkage_vs_truth-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">score_linkage_vs_truth</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">found_matches</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="nb">set</span><span class="p">]</span>,</span><span class="param">	<span class="n">true_matches</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="nb">set</span><span class="p">]</span>,</span><span class="param">	<span class="n">records_in_dataset</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">expand_clusters_pairwise</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">tuple</span>:</span></span>

                <label class="view-source-button" for="score_linkage_vs_truth-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#score_linkage_vs_truth"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="score_linkage_vs_truth-746"><a href="#score_linkage_vs_truth-746"><span class="linenos">746</span></a><span class="k">def</span> <span class="nf">score_linkage_vs_truth</span><span class="p">(</span>
</span><span id="score_linkage_vs_truth-747"><a href="#score_linkage_vs_truth-747"><span class="linenos">747</span></a>    <span class="n">found_matches</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="nb">set</span><span class="p">],</span>
</span><span id="score_linkage_vs_truth-748"><a href="#score_linkage_vs_truth-748"><span class="linenos">748</span></a>    <span class="n">true_matches</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="nb">set</span><span class="p">],</span>
</span><span id="score_linkage_vs_truth-749"><a href="#score_linkage_vs_truth-749"><span class="linenos">749</span></a>    <span class="n">records_in_dataset</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="score_linkage_vs_truth-750"><a href="#score_linkage_vs_truth-750"><span class="linenos">750</span></a>    <span class="n">expand_clusters_pairwise</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="score_linkage_vs_truth-751"><a href="#score_linkage_vs_truth-751"><span class="linenos">751</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="score_linkage_vs_truth-752"><a href="#score_linkage_vs_truth-752"><span class="linenos">752</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="score_linkage_vs_truth-753"><a href="#score_linkage_vs_truth-753"><span class="linenos">753</span></a><span class="sd">    Compute the statistical qualities of a run of record linkage against</span>
</span><span id="score_linkage_vs_truth-754"><a href="#score_linkage_vs_truth-754"><span class="linenos">754</span></a><span class="sd">    known true results. This function assumes that matches have already</span>
</span><span id="score_linkage_vs_truth-755"><a href="#score_linkage_vs_truth-755"><span class="linenos">755</span></a><span class="sd">    been determined by the algorithm, and further assumes that true</span>
</span><span id="score_linkage_vs_truth-756"><a href="#score_linkage_vs_truth-756"><span class="linenos">756</span></a><span class="sd">    matches have already been identified in the data.</span>
</span><span id="score_linkage_vs_truth-757"><a href="#score_linkage_vs_truth-757"><span class="linenos">757</span></a>
</span><span id="score_linkage_vs_truth-758"><a href="#score_linkage_vs_truth-758"><span class="linenos">758</span></a><span class="sd">    :param found_matches: A dictionary mapping IDs of records to sets of</span>
</span><span id="score_linkage_vs_truth-759"><a href="#score_linkage_vs_truth-759"><span class="linenos">759</span></a><span class="sd">      other records which were determined to be a match.</span>
</span><span id="score_linkage_vs_truth-760"><a href="#score_linkage_vs_truth-760"><span class="linenos">760</span></a><span class="sd">    :param true_matches: A dictionary mapping IDs of records to sets of</span>
</span><span id="score_linkage_vs_truth-761"><a href="#score_linkage_vs_truth-761"><span class="linenos">761</span></a><span class="sd">      other records which are _known_ to be a true match.</span>
</span><span id="score_linkage_vs_truth-762"><a href="#score_linkage_vs_truth-762"><span class="linenos">762</span></a><span class="sd">    :param records_in_dataset: The number of records in the original data</span>
</span><span id="score_linkage_vs_truth-763"><a href="#score_linkage_vs_truth-763"><span class="linenos">763</span></a><span class="sd">      set to-link.</span>
</span><span id="score_linkage_vs_truth-764"><a href="#score_linkage_vs_truth-764"><span class="linenos">764</span></a><span class="sd">    :param expand_clusters_pairwise: Optionally, whether we need to take</span>
</span><span id="score_linkage_vs_truth-765"><a href="#score_linkage_vs_truth-765"><span class="linenos">765</span></a><span class="sd">      the cross-product of members within the sets of the match list. This</span>
</span><span id="score_linkage_vs_truth-766"><a href="#score_linkage_vs_truth-766"><span class="linenos">766</span></a><span class="sd">      parameter only needs to be used if the linkage algorithm was run in</span>
</span><span id="score_linkage_vs_truth-767"><a href="#score_linkage_vs_truth-767"><span class="linenos">767</span></a><span class="sd">      cluster mode. Default is False.</span>
</span><span id="score_linkage_vs_truth-768"><a href="#score_linkage_vs_truth-768"><span class="linenos">768</span></a><span class="sd">    :return: A tuple reporting the sensitivity/precision, specificity/recall,</span>
</span><span id="score_linkage_vs_truth-769"><a href="#score_linkage_vs_truth-769"><span class="linenos">769</span></a><span class="sd">      positive prediction value, and F1 score of the linkage algorithm.</span>
</span><span id="score_linkage_vs_truth-770"><a href="#score_linkage_vs_truth-770"><span class="linenos">770</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="score_linkage_vs_truth-771"><a href="#score_linkage_vs_truth-771"><span class="linenos">771</span></a>
</span><span id="score_linkage_vs_truth-772"><a href="#score_linkage_vs_truth-772"><span class="linenos">772</span></a>    <span class="c1"># If cluster mode was used, only the &quot;master&quot; patient&#39;s set will exist</span>
</span><span id="score_linkage_vs_truth-773"><a href="#score_linkage_vs_truth-773"><span class="linenos">773</span></a>    <span class="c1"># Need to expand other permutations for accurate statistics</span>
</span><span id="score_linkage_vs_truth-774"><a href="#score_linkage_vs_truth-774"><span class="linenos">774</span></a>    <span class="k">if</span> <span class="n">expand_clusters_pairwise</span><span class="p">:</span>
</span><span id="score_linkage_vs_truth-775"><a href="#score_linkage_vs_truth-775"><span class="linenos">775</span></a>        <span class="n">new_found_matches</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="score_linkage_vs_truth-776"><a href="#score_linkage_vs_truth-776"><span class="linenos">776</span></a>        <span class="k">for</span> <span class="n">root_rec</span> <span class="ow">in</span> <span class="n">found_matches</span><span class="p">:</span>
</span><span id="score_linkage_vs_truth-777"><a href="#score_linkage_vs_truth-777"><span class="linenos">777</span></a>            <span class="k">if</span> <span class="n">root_rec</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_found_matches</span><span class="p">:</span>
</span><span id="score_linkage_vs_truth-778"><a href="#score_linkage_vs_truth-778"><span class="linenos">778</span></a>                <span class="n">new_found_matches</span><span class="p">[</span><span class="n">root_rec</span><span class="p">]</span> <span class="o">=</span> <span class="n">found_matches</span><span class="p">[</span><span class="n">root_rec</span><span class="p">]</span>
</span><span id="score_linkage_vs_truth-779"><a href="#score_linkage_vs_truth-779"><span class="linenos">779</span></a>            <span class="k">for</span> <span class="n">paired_record</span> <span class="ow">in</span> <span class="n">found_matches</span><span class="p">[</span><span class="n">root_rec</span><span class="p">]:</span>
</span><span id="score_linkage_vs_truth-780"><a href="#score_linkage_vs_truth-780"><span class="linenos">780</span></a>                <span class="k">if</span> <span class="n">paired_record</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_found_matches</span><span class="p">:</span>
</span><span id="score_linkage_vs_truth-781"><a href="#score_linkage_vs_truth-781"><span class="linenos">781</span></a>                    <span class="n">new_found_matches</span><span class="p">[</span><span class="n">paired_record</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="score_linkage_vs_truth-782"><a href="#score_linkage_vs_truth-782"><span class="linenos">782</span></a>                <span class="k">for</span> <span class="n">other_record</span> <span class="ow">in</span> <span class="n">found_matches</span><span class="p">[</span><span class="n">root_rec</span><span class="p">]:</span>
</span><span id="score_linkage_vs_truth-783"><a href="#score_linkage_vs_truth-783"><span class="linenos">783</span></a>                    <span class="k">if</span> <span class="n">other_record</span> <span class="o">&gt;</span> <span class="n">paired_record</span><span class="p">:</span>
</span><span id="score_linkage_vs_truth-784"><a href="#score_linkage_vs_truth-784"><span class="linenos">784</span></a>                        <span class="n">new_found_matches</span><span class="p">[</span><span class="n">paired_record</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other_record</span><span class="p">)</span>
</span><span id="score_linkage_vs_truth-785"><a href="#score_linkage_vs_truth-785"><span class="linenos">785</span></a>        <span class="n">found_matches</span> <span class="o">=</span> <span class="n">new_found_matches</span>
</span><span id="score_linkage_vs_truth-786"><a href="#score_linkage_vs_truth-786"><span class="linenos">786</span></a>
</span><span id="score_linkage_vs_truth-787"><a href="#score_linkage_vs_truth-787"><span class="linenos">787</span></a>    <span class="c1"># Need division by 2 because ordering is irrelevant, matches are symmetric</span>
</span><span id="score_linkage_vs_truth-788"><a href="#score_linkage_vs_truth-788"><span class="linenos">788</span></a>    <span class="n">total_possible_matches</span> <span class="o">=</span> <span class="p">(</span><span class="n">records_in_dataset</span> <span class="o">*</span> <span class="p">(</span><span class="n">records_in_dataset</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="mf">2.0</span>
</span><span id="score_linkage_vs_truth-789"><a href="#score_linkage_vs_truth-789"><span class="linenos">789</span></a>    <span class="n">true_positives</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="score_linkage_vs_truth-790"><a href="#score_linkage_vs_truth-790"><span class="linenos">790</span></a>    <span class="n">false_positives</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="score_linkage_vs_truth-791"><a href="#score_linkage_vs_truth-791"><span class="linenos">791</span></a>    <span class="n">false_negatives</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="score_linkage_vs_truth-792"><a href="#score_linkage_vs_truth-792"><span class="linenos">792</span></a>
</span><span id="score_linkage_vs_truth-793"><a href="#score_linkage_vs_truth-793"><span class="linenos">793</span></a>    <span class="k">for</span> <span class="n">root_record</span> <span class="ow">in</span> <span class="n">true_matches</span><span class="p">:</span>
</span><span id="score_linkage_vs_truth-794"><a href="#score_linkage_vs_truth-794"><span class="linenos">794</span></a>        <span class="k">if</span> <span class="n">root_record</span> <span class="ow">in</span> <span class="n">found_matches</span><span class="p">:</span>
</span><span id="score_linkage_vs_truth-795"><a href="#score_linkage_vs_truth-795"><span class="linenos">795</span></a>            <span class="n">true_positives</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span>
</span><span id="score_linkage_vs_truth-796"><a href="#score_linkage_vs_truth-796"><span class="linenos">796</span></a>                <span class="n">true_matches</span><span class="p">[</span><span class="n">root_record</span><span class="p">]</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">found_matches</span><span class="p">[</span><span class="n">root_record</span><span class="p">])</span>
</span><span id="score_linkage_vs_truth-797"><a href="#score_linkage_vs_truth-797"><span class="linenos">797</span></a>            <span class="p">)</span>
</span><span id="score_linkage_vs_truth-798"><a href="#score_linkage_vs_truth-798"><span class="linenos">798</span></a>            <span class="n">false_positives</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span>
</span><span id="score_linkage_vs_truth-799"><a href="#score_linkage_vs_truth-799"><span class="linenos">799</span></a>                <span class="n">found_matches</span><span class="p">[</span><span class="n">root_record</span><span class="p">]</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">true_matches</span><span class="p">[</span><span class="n">root_record</span><span class="p">])</span>
</span><span id="score_linkage_vs_truth-800"><a href="#score_linkage_vs_truth-800"><span class="linenos">800</span></a>            <span class="p">)</span>
</span><span id="score_linkage_vs_truth-801"><a href="#score_linkage_vs_truth-801"><span class="linenos">801</span></a>            <span class="n">false_negatives</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span>
</span><span id="score_linkage_vs_truth-802"><a href="#score_linkage_vs_truth-802"><span class="linenos">802</span></a>                <span class="n">true_matches</span><span class="p">[</span><span class="n">root_record</span><span class="p">]</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">found_matches</span><span class="p">[</span><span class="n">root_record</span><span class="p">])</span>
</span><span id="score_linkage_vs_truth-803"><a href="#score_linkage_vs_truth-803"><span class="linenos">803</span></a>            <span class="p">)</span>
</span><span id="score_linkage_vs_truth-804"><a href="#score_linkage_vs_truth-804"><span class="linenos">804</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="score_linkage_vs_truth-805"><a href="#score_linkage_vs_truth-805"><span class="linenos">805</span></a>            <span class="n">false_negatives</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">true_matches</span><span class="p">[</span><span class="n">root_record</span><span class="p">])</span>
</span><span id="score_linkage_vs_truth-806"><a href="#score_linkage_vs_truth-806"><span class="linenos">806</span></a>    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">found_matches</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">true_matches</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
</span><span id="score_linkage_vs_truth-807"><a href="#score_linkage_vs_truth-807"><span class="linenos">807</span></a>        <span class="n">false_positives</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">found_matches</span><span class="p">[</span><span class="n">record</span><span class="p">])</span>
</span><span id="score_linkage_vs_truth-808"><a href="#score_linkage_vs_truth-808"><span class="linenos">808</span></a>
</span><span id="score_linkage_vs_truth-809"><a href="#score_linkage_vs_truth-809"><span class="linenos">809</span></a>    <span class="n">true_negatives</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="score_linkage_vs_truth-810"><a href="#score_linkage_vs_truth-810"><span class="linenos">810</span></a>        <span class="n">total_possible_matches</span> <span class="o">-</span> <span class="n">true_positives</span> <span class="o">-</span> <span class="n">false_positives</span> <span class="o">-</span> <span class="n">false_negatives</span>
</span><span id="score_linkage_vs_truth-811"><a href="#score_linkage_vs_truth-811"><span class="linenos">811</span></a>    <span class="p">)</span>
</span><span id="score_linkage_vs_truth-812"><a href="#score_linkage_vs_truth-812"><span class="linenos">812</span></a>
</span><span id="score_linkage_vs_truth-813"><a href="#score_linkage_vs_truth-813"><span class="linenos">813</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;True Positives Found:&quot;</span><span class="p">,</span> <span class="n">true_positives</span><span class="p">)</span>
</span><span id="score_linkage_vs_truth-814"><a href="#score_linkage_vs_truth-814"><span class="linenos">814</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;False Positives Misidentified:&quot;</span><span class="p">,</span> <span class="n">false_positives</span><span class="p">)</span>
</span><span id="score_linkage_vs_truth-815"><a href="#score_linkage_vs_truth-815"><span class="linenos">815</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;False Negatives Missed:&quot;</span><span class="p">,</span> <span class="n">false_negatives</span><span class="p">)</span>
</span><span id="score_linkage_vs_truth-816"><a href="#score_linkage_vs_truth-816"><span class="linenos">816</span></a>
</span><span id="score_linkage_vs_truth-817"><a href="#score_linkage_vs_truth-817"><span class="linenos">817</span></a>    <span class="n">sensitivity</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">true_positives</span> <span class="o">/</span> <span class="p">(</span><span class="n">true_positives</span> <span class="o">+</span> <span class="n">false_negatives</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="score_linkage_vs_truth-818"><a href="#score_linkage_vs_truth-818"><span class="linenos">818</span></a>    <span class="n">specificity</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">true_negatives</span> <span class="o">/</span> <span class="p">(</span><span class="n">true_negatives</span> <span class="o">+</span> <span class="n">false_positives</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="score_linkage_vs_truth-819"><a href="#score_linkage_vs_truth-819"><span class="linenos">819</span></a>    <span class="n">ppv</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">true_positives</span> <span class="o">/</span> <span class="p">(</span><span class="n">true_positives</span> <span class="o">+</span> <span class="n">false_positives</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="score_linkage_vs_truth-820"><a href="#score_linkage_vs_truth-820"><span class="linenos">820</span></a>    <span class="n">f1</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span>
</span><span id="score_linkage_vs_truth-821"><a href="#score_linkage_vs_truth-821"><span class="linenos">821</span></a>        <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">true_positives</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">true_positives</span> <span class="o">+</span> <span class="n">false_negatives</span> <span class="o">+</span> <span class="n">false_positives</span><span class="p">),</span>
</span><span id="score_linkage_vs_truth-822"><a href="#score_linkage_vs_truth-822"><span class="linenos">822</span></a>        <span class="mi">3</span><span class="p">,</span>
</span><span id="score_linkage_vs_truth-823"><a href="#score_linkage_vs_truth-823"><span class="linenos">823</span></a>    <span class="p">)</span>
</span><span id="score_linkage_vs_truth-824"><a href="#score_linkage_vs_truth-824"><span class="linenos">824</span></a>    <span class="k">return</span> <span class="p">(</span><span class="n">sensitivity</span><span class="p">,</span> <span class="n">specificity</span><span class="p">,</span> <span class="n">ppv</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compute the statistical qualities of a run of record linkage against
known true results. This function assumes that matches have already
been determined by the algorithm, and further assumes that true
matches have already been identified in the data.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>found_matches</strong>:  A dictionary mapping IDs of records to sets of
other records which were determined to be a match.</li>
<li><strong>true_matches</strong>:  A dictionary mapping IDs of records to sets of
other records which are _known_ to be a true match.</li>
<li><strong>records_in_dataset</strong>:  The number of records in the original data
set to-link.</li>
<li><strong>expand_clusters_pairwise</strong>:  Optionally, whether we need to take
the cross-product of members within the sets of the match list. This
parameter only needs to be used if the linkage algorithm was run in
cluster mode. Default is False.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>A tuple reporting the sensitivity/precision, specificity/recall,
    positive prediction value, and F1 score of the linkage algorithm.</p>
</blockquote>
</div>


                </section>
                <section id="block_data_from_db">
                            <input id="block_data_from_db-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">block_data_from_db</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">db_name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">block_data</span><span class="p">:</span> <span class="n">Dict</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="block_data_from_db-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#block_data_from_db"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="block_data_from_db-848"><a href="#block_data_from_db-848"><span class="linenos">848</span></a><span class="k">def</span> <span class="nf">block_data_from_db</span><span class="p">(</span><span class="n">db_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">block_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">list</span><span class="p">]:</span>
</span><span id="block_data_from_db-849"><a href="#block_data_from_db-849"><span class="linenos">849</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="block_data_from_db-850"><a href="#block_data_from_db-850"><span class="linenos">850</span></a><span class="sd">    Returns a list of lists containing records from the database that match on the</span>
</span><span id="block_data_from_db-851"><a href="#block_data_from_db-851"><span class="linenos">851</span></a><span class="sd">    incoming record&#39;s block values. If blocking on &#39;ZIP&#39; and the incoming record&#39;s zip</span>
</span><span id="block_data_from_db-852"><a href="#block_data_from_db-852"><span class="linenos">852</span></a><span class="sd">    code is &#39;90210&#39;, the resulting block of data would contain records that all have the</span>
</span><span id="block_data_from_db-853"><a href="#block_data_from_db-853"><span class="linenos">853</span></a><span class="sd">    same zip code of 90210.</span>
</span><span id="block_data_from_db-854"><a href="#block_data_from_db-854"><span class="linenos">854</span></a>
</span><span id="block_data_from_db-855"><a href="#block_data_from_db-855"><span class="linenos">855</span></a><span class="sd">    :param db_name: Database name.</span>
</span><span id="block_data_from_db-856"><a href="#block_data_from_db-856"><span class="linenos">856</span></a><span class="sd">    :param table_name: Table name.</span>
</span><span id="block_data_from_db-857"><a href="#block_data_from_db-857"><span class="linenos">857</span></a><span class="sd">    :param block_data: Dictionary containing key value pairs for the column name for</span>
</span><span id="block_data_from_db-858"><a href="#block_data_from_db-858"><span class="linenos">858</span></a><span class="sd">      blocking and the data for the incoming record, e.g., [&quot;ZIP&quot;]: &quot;90210&quot;.</span>
</span><span id="block_data_from_db-859"><a href="#block_data_from_db-859"><span class="linenos">859</span></a><span class="sd">    :return: A list of records that are within the block, e.g., records that all have</span>
</span><span id="block_data_from_db-860"><a href="#block_data_from_db-860"><span class="linenos">860</span></a><span class="sd">      90210 as their ZIP.</span>
</span><span id="block_data_from_db-861"><a href="#block_data_from_db-861"><span class="linenos">861</span></a>
</span><span id="block_data_from_db-862"><a href="#block_data_from_db-862"><span class="linenos">862</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="block_data_from_db-863"><a href="#block_data_from_db-863"><span class="linenos">863</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">block_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="block_data_from_db-864"><a href="#block_data_from_db-864"><span class="linenos">864</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`block_data` cannot be empty.&quot;</span><span class="p">)</span>
</span><span id="block_data_from_db-865"><a href="#block_data_from_db-865"><span class="linenos">865</span></a>
</span><span id="block_data_from_db-866"><a href="#block_data_from_db-866"><span class="linenos">866</span></a>    <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_name</span><span class="p">)</span>
</span><span id="block_data_from_db-867"><a href="#block_data_from_db-867"><span class="linenos">867</span></a>    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span><span id="block_data_from_db-868"><a href="#block_data_from_db-868"><span class="linenos">868</span></a>    <span class="n">cursor</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">,</span> <span class="n">row</span><span class="p">:</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span>
</span><span id="block_data_from_db-869"><a href="#block_data_from_db-869"><span class="linenos">869</span></a>
</span><span id="block_data_from_db-870"><a href="#block_data_from_db-870"><span class="linenos">870</span></a>    <span class="n">query</span> <span class="o">=</span> <span class="n">_generate_block_query</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">block_data</span><span class="p">)</span>  <span class="c1"># Generate SQL query</span>
</span><span id="block_data_from_db-871"><a href="#block_data_from_db-871"><span class="linenos">871</span></a>    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>  <span class="c1"># Execute query</span>
</span><span id="block_data_from_db-872"><a href="#block_data_from_db-872"><span class="linenos">872</span></a>    <span class="n">block</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>  <span class="c1"># Fetch data from query</span>
</span><span id="block_data_from_db-873"><a href="#block_data_from_db-873"><span class="linenos">873</span></a>    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span id="block_data_from_db-874"><a href="#block_data_from_db-874"><span class="linenos">874</span></a>    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="block_data_from_db-875"><a href="#block_data_from_db-875"><span class="linenos">875</span></a>
</span><span id="block_data_from_db-876"><a href="#block_data_from_db-876"><span class="linenos">876</span></a>    <span class="k">return</span> <span class="n">block</span>
</span></pre></div>


            <div class="docstring"><p>Returns a list of lists containing records from the database that match on the
incoming record's block values. If blocking on 'ZIP' and the incoming record's zip
code is '90210', the resulting block of data would contain records that all have the
same zip code of 90210.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>db_name</strong>:  Database name.</li>
<li><strong>table_name</strong>:  Table name.</li>
<li><strong>block_data</strong>:  Dictionary containing key value pairs for the column name for
blocking and the data for the incoming record, e.g., ["ZIP"]: "90210".</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>A list of records that are within the block, e.g., records that all have
    90210 as their ZIP.</p>
</blockquote>
</div>


                </section>
                <section id="_generate_block_query">
                            <input id="_generate_block_query-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">_generate_block_query</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">block_data</span><span class="p">:</span> <span class="n">Dict</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="_generate_block_query-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#_generate_block_query"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="_generate_block_query-879"><a href="#_generate_block_query-879"><span class="linenos">879</span></a><span class="k">def</span> <span class="nf">_generate_block_query</span><span class="p">(</span><span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">block_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="_generate_block_query-880"><a href="#_generate_block_query-880"><span class="linenos">880</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="_generate_block_query-881"><a href="#_generate_block_query-881"><span class="linenos">881</span></a><span class="sd">    Generates a query for selecting a block of data from `table_name` per the block_data</span>
</span><span id="_generate_block_query-882"><a href="#_generate_block_query-882"><span class="linenos">882</span></a><span class="sd">    parameters.</span>
</span><span id="_generate_block_query-883"><a href="#_generate_block_query-883"><span class="linenos">883</span></a>
</span><span id="_generate_block_query-884"><a href="#_generate_block_query-884"><span class="linenos">884</span></a><span class="sd">    :param table_name: Table name.</span>
</span><span id="_generate_block_query-885"><a href="#_generate_block_query-885"><span class="linenos">885</span></a><span class="sd">    :param block_data: Dictionary containing key value pairs for the column name you for</span>
</span><span id="_generate_block_query-886"><a href="#_generate_block_query-886"><span class="linenos">886</span></a><span class="sd">      blocking and the data for the incoming record, e.g., [&quot;ZIP&quot;]: &quot;90210&quot;.</span>
</span><span id="_generate_block_query-887"><a href="#_generate_block_query-887"><span class="linenos">887</span></a><span class="sd">    :return: Query to select block of data base on `block_data` parameters.</span>
</span><span id="_generate_block_query-888"><a href="#_generate_block_query-888"><span class="linenos">888</span></a>
</span><span id="_generate_block_query-889"><a href="#_generate_block_query-889"><span class="linenos">889</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="_generate_block_query-890"><a href="#_generate_block_query-890"><span class="linenos">890</span></a>    <span class="n">query_stub</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> WHERE &quot;</span>
</span><span id="_generate_block_query-891"><a href="#_generate_block_query-891"><span class="linenos">891</span></a>    <span class="n">block_query</span> <span class="o">=</span> <span class="s2">&quot; AND &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="_generate_block_query-892"><a href="#_generate_block_query-892"><span class="linenos">892</span></a>        <span class="p">[</span>
</span><span id="_generate_block_query-893"><a href="#_generate_block_query-893"><span class="linenos">893</span></a>            <span class="n">key</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; = &#39;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;&quot;</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span> <span class="k">else</span> <span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; = </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="_generate_block_query-894"><a href="#_generate_block_query-894"><span class="linenos">894</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">block_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="_generate_block_query-895"><a href="#_generate_block_query-895"><span class="linenos">895</span></a>        <span class="p">]</span>
</span><span id="_generate_block_query-896"><a href="#_generate_block_query-896"><span class="linenos">896</span></a>    <span class="p">)</span>
</span><span id="_generate_block_query-897"><a href="#_generate_block_query-897"><span class="linenos">897</span></a>    <span class="n">query</span> <span class="o">=</span> <span class="n">query_stub</span> <span class="o">+</span> <span class="n">block_query</span>
</span><span id="_generate_block_query-898"><a href="#_generate_block_query-898"><span class="linenos">898</span></a>    <span class="k">return</span> <span class="n">query</span>
</span></pre></div>


            <div class="docstring"><p>Generates a query for selecting a block of data from <code>table_name</code> per the block_data
parameters.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>table_name</strong>:  Table name.</li>
<li><strong>block_data</strong>:  Dictionary containing key value pairs for the column name you for
blocking and the data for the incoming record, e.g., ["ZIP"]: "90210".</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Query to select block of data base on <code><a href="#block_data">block_data</a></code> parameters.</p>
</blockquote>
</div>


                </section>
                <section id="calculate_m_probs">
                            <input id="calculate_m_probs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">calculate_m_probs</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	<span class="n">true_matches</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">cols</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">file_to_write</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="calculate_m_probs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#calculate_m_probs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="calculate_m_probs-70"><a href="#calculate_m_probs-70"><span class="linenos"> 70</span></a><span class="k">def</span> <span class="nf">calculate_m_probs</span><span class="p">(</span>
</span><span id="calculate_m_probs-71"><a href="#calculate_m_probs-71"><span class="linenos"> 71</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="calculate_m_probs-72"><a href="#calculate_m_probs-72"><span class="linenos"> 72</span></a>    <span class="n">true_matches</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="calculate_m_probs-73"><a href="#calculate_m_probs-73"><span class="linenos"> 73</span></a>    <span class="n">cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="calculate_m_probs-74"><a href="#calculate_m_probs-74"><span class="linenos"> 74</span></a>    <span class="n">file_to_write</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="calculate_m_probs-75"><a href="#calculate_m_probs-75"><span class="linenos"> 75</span></a><span class="p">):</span>
</span><span id="calculate_m_probs-76"><a href="#calculate_m_probs-76"><span class="linenos"> 76</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="calculate_m_probs-77"><a href="#calculate_m_probs-77"><span class="linenos"> 77</span></a><span class="sd">    For a given set of patient records, calculate the per-field</span>
</span><span id="calculate_m_probs-78"><a href="#calculate_m_probs-78"><span class="linenos"> 78</span></a><span class="sd">    m-probability. The m-probability for field X is defined as the</span>
</span><span id="calculate_m_probs-79"><a href="#calculate_m_probs-79"><span class="linenos"> 79</span></a><span class="sd">    probability that a pair of records A and B have the same value in</span>
</span><span id="calculate_m_probs-80"><a href="#calculate_m_probs-80"><span class="linenos"> 80</span></a><span class="sd">    X, given that A and B are a true matching pair. This function</span>
</span><span id="calculate_m_probs-81"><a href="#calculate_m_probs-81"><span class="linenos"> 81</span></a><span class="sd">    incorporates LaPlacian Smoothing to account for unseen data and</span>
</span><span id="calculate_m_probs-82"><a href="#calculate_m_probs-82"><span class="linenos"> 82</span></a><span class="sd">    to resolve future logarithms against 0.</span>
</span><span id="calculate_m_probs-83"><a href="#calculate_m_probs-83"><span class="linenos"> 83</span></a>
</span><span id="calculate_m_probs-84"><a href="#calculate_m_probs-84"><span class="linenos"> 84</span></a><span class="sd">    :param data: A pandas dataframe of patient records to compute</span>
</span><span id="calculate_m_probs-85"><a href="#calculate_m_probs-85"><span class="linenos"> 85</span></a><span class="sd">      probabilities for.</span>
</span><span id="calculate_m_probs-86"><a href="#calculate_m_probs-86"><span class="linenos"> 86</span></a><span class="sd">    :param true_matches: A dictionary holding the IDs of record pairs</span>
</span><span id="calculate_m_probs-87"><a href="#calculate_m_probs-87"><span class="linenos"> 87</span></a><span class="sd">      that are true matches in the data set. The format of the dictionary</span>
</span><span id="calculate_m_probs-88"><a href="#calculate_m_probs-88"><span class="linenos"> 88</span></a><span class="sd">      should be such that the IDs of the &quot;lower numbered&quot; records in each</span>
</span><span id="calculate_m_probs-89"><a href="#calculate_m_probs-89"><span class="linenos"> 89</span></a><span class="sd">      match pair are the keys, and the values are sets of the &quot;higher</span>
</span><span id="calculate_m_probs-90"><a href="#calculate_m_probs-90"><span class="linenos"> 90</span></a><span class="sd">      numbered&quot; records in each pair.</span>
</span><span id="calculate_m_probs-91"><a href="#calculate_m_probs-91"><span class="linenos"> 91</span></a><span class="sd">    :param cols: Optionally, a list of columns to compute probabilities</span>
</span><span id="calculate_m_probs-92"><a href="#calculate_m_probs-92"><span class="linenos"> 92</span></a><span class="sd">      for. If not supplied, computes probabilities across all fields.</span>
</span><span id="calculate_m_probs-93"><a href="#calculate_m_probs-93"><span class="linenos"> 93</span></a><span class="sd">      Default is None.</span>
</span><span id="calculate_m_probs-94"><a href="#calculate_m_probs-94"><span class="linenos"> 94</span></a><span class="sd">    :param file_to_write: Optionally, a destination filepath at which to</span>
</span><span id="calculate_m_probs-95"><a href="#calculate_m_probs-95"><span class="linenos"> 95</span></a><span class="sd">      write the probabilities in JSON format. Default is None.</span>
</span><span id="calculate_m_probs-96"><a href="#calculate_m_probs-96"><span class="linenos"> 96</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="calculate_m_probs-97"><a href="#calculate_m_probs-97"><span class="linenos"> 97</span></a>    <span class="k">if</span> <span class="n">cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="calculate_m_probs-98"><a href="#calculate_m_probs-98"><span class="linenos"> 98</span></a>        <span class="n">cols</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span>
</span><span id="calculate_m_probs-99"><a href="#calculate_m_probs-99"><span class="linenos"> 99</span></a>    <span class="n">m_probs</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="mf">1.0</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">}</span>
</span><span id="calculate_m_probs-100"><a href="#calculate_m_probs-100"><span class="linenos">100</span></a>    <span class="n">total_pairs</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="calculate_m_probs-101"><a href="#calculate_m_probs-101"><span class="linenos">101</span></a>    <span class="k">for</span> <span class="n">root_record</span><span class="p">,</span> <span class="n">paired_records</span> <span class="ow">in</span> <span class="n">true_matches</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="calculate_m_probs-102"><a href="#calculate_m_probs-102"><span class="linenos">102</span></a>        <span class="n">total_pairs</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">paired_records</span><span class="p">)</span>
</span><span id="calculate_m_probs-103"><a href="#calculate_m_probs-103"><span class="linenos">103</span></a>        <span class="k">for</span> <span class="n">pr</span> <span class="ow">in</span> <span class="n">paired_records</span><span class="p">:</span>
</span><span id="calculate_m_probs-104"><a href="#calculate_m_probs-104"><span class="linenos">104</span></a>            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
</span><span id="calculate_m_probs-105"><a href="#calculate_m_probs-105"><span class="linenos">105</span></a>                <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">root_record</span><span class="p">]</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">pr</span><span class="p">]:</span>
</span><span id="calculate_m_probs-106"><a href="#calculate_m_probs-106"><span class="linenos">106</span></a>                    <span class="n">m_probs</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="calculate_m_probs-107"><a href="#calculate_m_probs-107"><span class="linenos">107</span></a>    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
</span><span id="calculate_m_probs-108"><a href="#calculate_m_probs-108"><span class="linenos">108</span></a>        <span class="n">m_probs</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">/=</span> <span class="n">total_pairs</span>
</span><span id="calculate_m_probs-109"><a href="#calculate_m_probs-109"><span class="linenos">109</span></a>
</span><span id="calculate_m_probs-110"><a href="#calculate_m_probs-110"><span class="linenos">110</span></a>    <span class="n">_write_prob_file</span><span class="p">(</span><span class="n">m_probs</span><span class="p">,</span> <span class="n">file_to_write</span><span class="p">)</span>
</span><span id="calculate_m_probs-111"><a href="#calculate_m_probs-111"><span class="linenos">111</span></a>    <span class="k">return</span> <span class="n">m_probs</span>
</span></pre></div>


            <div class="docstring"><p>For a given set of patient records, calculate the per-field
m-probability. The m-probability for field X is defined as the
probability that a pair of records A and B have the same value in
X, given that A and B are a true matching pair. This function
incorporates LaPlacian Smoothing to account for unseen data and
to resolve future logarithms against 0.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>data</strong>:  A pandas dataframe of patient records to compute
probabilities for.</li>
<li><strong>true_matches</strong>:  A dictionary holding the IDs of record pairs
that are true matches in the data set. The format of the dictionary
should be such that the IDs of the "lower numbered" records in each
match pair are the keys, and the values are sets of the "higher
numbered" records in each pair.</li>
<li><strong>cols</strong>:  Optionally, a list of columns to compute probabilities
for. If not supplied, computes probabilities across all fields.
Default is None.</li>
<li><strong>file_to_write</strong>:  Optionally, a destination filepath at which to
write the probabilities in JSON format. Default is None.</li>
</ul>
</div>


                </section>
                <section id="calculate_u_probs">
                            <input id="calculate_u_probs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">calculate_u_probs</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	<span class="n">true_matches</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">n_samples</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">cols</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">file_to_write</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="calculate_u_probs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#calculate_u_probs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="calculate_u_probs-118"><a href="#calculate_u_probs-118"><span class="linenos">118</span></a><span class="k">def</span> <span class="nf">calculate_u_probs</span><span class="p">(</span>
</span><span id="calculate_u_probs-119"><a href="#calculate_u_probs-119"><span class="linenos">119</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="calculate_u_probs-120"><a href="#calculate_u_probs-120"><span class="linenos">120</span></a>    <span class="n">true_matches</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="calculate_u_probs-121"><a href="#calculate_u_probs-121"><span class="linenos">121</span></a>    <span class="n">n_samples</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="calculate_u_probs-122"><a href="#calculate_u_probs-122"><span class="linenos">122</span></a>    <span class="n">cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="calculate_u_probs-123"><a href="#calculate_u_probs-123"><span class="linenos">123</span></a>    <span class="n">file_to_write</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="calculate_u_probs-124"><a href="#calculate_u_probs-124"><span class="linenos">124</span></a><span class="p">):</span>
</span><span id="calculate_u_probs-125"><a href="#calculate_u_probs-125"><span class="linenos">125</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="calculate_u_probs-126"><a href="#calculate_u_probs-126"><span class="linenos">126</span></a><span class="sd">    For a given set of patient records, calculate the per-field</span>
</span><span id="calculate_u_probs-127"><a href="#calculate_u_probs-127"><span class="linenos">127</span></a><span class="sd">    u-probability. The u-probability for field X is defined as the</span>
</span><span id="calculate_u_probs-128"><a href="#calculate_u_probs-128"><span class="linenos">128</span></a><span class="sd">    probability that a pair of records A and B have the same value in</span>
</span><span id="calculate_u_probs-129"><a href="#calculate_u_probs-129"><span class="linenos">129</span></a><span class="sd">    X, given that A and B are not a true matching pair. This function</span>
</span><span id="calculate_u_probs-130"><a href="#calculate_u_probs-130"><span class="linenos">130</span></a><span class="sd">    incorporates LaPlacian Smoothing to account for unseen data and</span>
</span><span id="calculate_u_probs-131"><a href="#calculate_u_probs-131"><span class="linenos">131</span></a><span class="sd">    to handle future logarithms against 0.</span>
</span><span id="calculate_u_probs-132"><a href="#calculate_u_probs-132"><span class="linenos">132</span></a>
</span><span id="calculate_u_probs-133"><a href="#calculate_u_probs-133"><span class="linenos">133</span></a><span class="sd">    Note: This function can be slow to compute for large data sets.</span>
</span><span id="calculate_u_probs-134"><a href="#calculate_u_probs-134"><span class="linenos">134</span></a><span class="sd">    It is recommended to pass only a representative subsample of the</span>
</span><span id="calculate_u_probs-135"><a href="#calculate_u_probs-135"><span class="linenos">135</span></a><span class="sd">    data to the function (we recommend sampling ~25k candidate pairs</span>
</span><span id="calculate_u_probs-136"><a href="#calculate_u_probs-136"><span class="linenos">136</span></a><span class="sd">    from a sub-sample of ~25k records), even if the sample operation</span>
</span><span id="calculate_u_probs-137"><a href="#calculate_u_probs-137"><span class="linenos">137</span></a><span class="sd">    is used.</span>
</span><span id="calculate_u_probs-138"><a href="#calculate_u_probs-138"><span class="linenos">138</span></a>
</span><span id="calculate_u_probs-139"><a href="#calculate_u_probs-139"><span class="linenos">139</span></a><span class="sd">    :param data: A pandas dataframe of patient records to compute</span>
</span><span id="calculate_u_probs-140"><a href="#calculate_u_probs-140"><span class="linenos">140</span></a><span class="sd">      probabilities for.</span>
</span><span id="calculate_u_probs-141"><a href="#calculate_u_probs-141"><span class="linenos">141</span></a><span class="sd">    :param true_matches: A dictionary holding the IDs of record pairs</span>
</span><span id="calculate_u_probs-142"><a href="#calculate_u_probs-142"><span class="linenos">142</span></a><span class="sd">      that are true matches in the data set. The format of the dictionary</span>
</span><span id="calculate_u_probs-143"><a href="#calculate_u_probs-143"><span class="linenos">143</span></a><span class="sd">      should be such that the IDs of the &quot;lower numbered&quot; records in each</span>
</span><span id="calculate_u_probs-144"><a href="#calculate_u_probs-144"><span class="linenos">144</span></a><span class="sd">      match pair are the keys, and the values are sets of the &quot;higher</span>
</span><span id="calculate_u_probs-145"><a href="#calculate_u_probs-145"><span class="linenos">145</span></a><span class="sd">      numbered&quot; records in each pair.</span>
</span><span id="calculate_u_probs-146"><a href="#calculate_u_probs-146"><span class="linenos">146</span></a><span class="sd">    :param n_samples: Optionally, a number of samples to take from the</span>
</span><span id="calculate_u_probs-147"><a href="#calculate_u_probs-147"><span class="linenos">147</span></a><span class="sd">      list of possible pairs to compute probabilities over.</span>
</span><span id="calculate_u_probs-148"><a href="#calculate_u_probs-148"><span class="linenos">148</span></a><span class="sd">    :param cols: Optionally, a list of columns to compute probabilities</span>
</span><span id="calculate_u_probs-149"><a href="#calculate_u_probs-149"><span class="linenos">149</span></a><span class="sd">      for. If not supplied, computes probabilities across all fields.</span>
</span><span id="calculate_u_probs-150"><a href="#calculate_u_probs-150"><span class="linenos">150</span></a><span class="sd">      Default is None.</span>
</span><span id="calculate_u_probs-151"><a href="#calculate_u_probs-151"><span class="linenos">151</span></a><span class="sd">    :param file_to_write: Optionally, a destination filepath at which to</span>
</span><span id="calculate_u_probs-152"><a href="#calculate_u_probs-152"><span class="linenos">152</span></a><span class="sd">      write the probabilities in JSON format. Default is None.</span>
</span><span id="calculate_u_probs-153"><a href="#calculate_u_probs-153"><span class="linenos">153</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="calculate_u_probs-154"><a href="#calculate_u_probs-154"><span class="linenos">154</span></a>    <span class="k">if</span> <span class="n">cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="calculate_u_probs-155"><a href="#calculate_u_probs-155"><span class="linenos">155</span></a>        <span class="n">cols</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span>
</span><span id="calculate_u_probs-156"><a href="#calculate_u_probs-156"><span class="linenos">156</span></a>
</span><span id="calculate_u_probs-157"><a href="#calculate_u_probs-157"><span class="linenos">157</span></a>    <span class="n">u_probs</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="mf">1.0</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">}</span>
</span><span id="calculate_u_probs-158"><a href="#calculate_u_probs-158"><span class="linenos">158</span></a>
</span><span id="calculate_u_probs-159"><a href="#calculate_u_probs-159"><span class="linenos">159</span></a>    <span class="c1"># Want only the pairs of candidates that aren&#39;t true matches</span>
</span><span id="calculate_u_probs-160"><a href="#calculate_u_probs-160"><span class="linenos">160</span></a>    <span class="n">base_pairs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="calculate_u_probs-161"><a href="#calculate_u_probs-161"><span class="linenos">161</span></a>    <span class="n">neg_pairs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="calculate_u_probs-162"><a href="#calculate_u_probs-162"><span class="linenos">162</span></a>        <span class="n">x</span>
</span><span id="calculate_u_probs-163"><a href="#calculate_u_probs-163"><span class="linenos">163</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">base_pairs</span>
</span><span id="calculate_u_probs-164"><a href="#calculate_u_probs-164"><span class="linenos">164</span></a>        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">true_matches</span> <span class="ow">or</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">true_matches</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="calculate_u_probs-165"><a href="#calculate_u_probs-165"><span class="linenos">165</span></a>    <span class="p">]</span>
</span><span id="calculate_u_probs-166"><a href="#calculate_u_probs-166"><span class="linenos">166</span></a>
</span><span id="calculate_u_probs-167"><a href="#calculate_u_probs-167"><span class="linenos">167</span></a>    <span class="k">if</span> <span class="n">n_samples</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">n_samples</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">neg_pairs</span><span class="p">):</span>
</span><span id="calculate_u_probs-168"><a href="#calculate_u_probs-168"><span class="linenos">168</span></a>        <span class="n">neg_pairs</span> <span class="o">=</span> <span class="n">sample</span><span class="p">(</span><span class="n">neg_pairs</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">)</span>
</span><span id="calculate_u_probs-169"><a href="#calculate_u_probs-169"><span class="linenos">169</span></a>    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">neg_pairs</span><span class="p">:</span>
</span><span id="calculate_u_probs-170"><a href="#calculate_u_probs-170"><span class="linenos">170</span></a>        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
</span><span id="calculate_u_probs-171"><a href="#calculate_u_probs-171"><span class="linenos">171</span></a>            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]]:</span>
</span><span id="calculate_u_probs-172"><a href="#calculate_u_probs-172"><span class="linenos">172</span></a>                <span class="n">u_probs</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
</span><span id="calculate_u_probs-173"><a href="#calculate_u_probs-173"><span class="linenos">173</span></a>
</span><span id="calculate_u_probs-174"><a href="#calculate_u_probs-174"><span class="linenos">174</span></a>    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
</span><span id="calculate_u_probs-175"><a href="#calculate_u_probs-175"><span class="linenos">175</span></a>        <span class="k">if</span> <span class="n">n_samples</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">n_samples</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">neg_pairs</span><span class="p">):</span>
</span><span id="calculate_u_probs-176"><a href="#calculate_u_probs-176"><span class="linenos">176</span></a>            <span class="n">u_probs</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_probs</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_samples</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="calculate_u_probs-177"><a href="#calculate_u_probs-177"><span class="linenos">177</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="calculate_u_probs-178"><a href="#calculate_u_probs-178"><span class="linenos">178</span></a>            <span class="n">u_probs</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_probs</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">neg_pairs</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="calculate_u_probs-179"><a href="#calculate_u_probs-179"><span class="linenos">179</span></a>
</span><span id="calculate_u_probs-180"><a href="#calculate_u_probs-180"><span class="linenos">180</span></a>    <span class="n">_write_prob_file</span><span class="p">(</span><span class="n">u_probs</span><span class="p">,</span> <span class="n">file_to_write</span><span class="p">)</span>
</span><span id="calculate_u_probs-181"><a href="#calculate_u_probs-181"><span class="linenos">181</span></a>    <span class="k">return</span> <span class="n">u_probs</span>
</span></pre></div>


            <div class="docstring"><p>For a given set of patient records, calculate the per-field
u-probability. The u-probability for field X is defined as the
probability that a pair of records A and B have the same value in
X, given that A and B are not a true matching pair. This function
incorporates LaPlacian Smoothing to account for unseen data and
to handle future logarithms against 0.</p>

<p>Note: This function can be slow to compute for large data sets.
It is recommended to pass only a representative subsample of the
data to the function (we recommend sampling ~25k candidate pairs
from a sub-sample of ~25k records), even if the sample operation
is used.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>data</strong>:  A pandas dataframe of patient records to compute
probabilities for.</li>
<li><strong>true_matches</strong>:  A dictionary holding the IDs of record pairs
that are true matches in the data set. The format of the dictionary
should be such that the IDs of the "lower numbered" records in each
match pair are the keys, and the values are sets of the "higher
numbered" records in each pair.</li>
<li><strong>n_samples</strong>:  Optionally, a number of samples to take from the
list of possible pairs to compute probabilities over.</li>
<li><strong>cols</strong>:  Optionally, a list of columns to compute probabilities
for. If not supplied, computes probabilities across all fields.
Default is None.</li>
<li><strong>file_to_write</strong>:  Optionally, a destination filepath at which to
write the probabilities in JSON format. Default is None.</li>
</ul>
</div>


                </section>
                <section id="load_json_probs">
                            <input id="load_json_probs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_json_probs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="load_json_probs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#load_json_probs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="load_json_probs-394"><a href="#load_json_probs-394"><span class="linenos">394</span></a><span class="k">def</span> <span class="nf">load_json_probs</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">):</span>
</span><span id="load_json_probs-395"><a href="#load_json_probs-395"><span class="linenos">395</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="load_json_probs-396"><a href="#load_json_probs-396"><span class="linenos">396</span></a><span class="sd">    Load a dictionary of probabilities from a JSON-formatted file.</span>
</span><span id="load_json_probs-397"><a href="#load_json_probs-397"><span class="linenos">397</span></a><span class="sd">    The probabilities correspond to previously computed m-, u-, or</span>
</span><span id="load_json_probs-398"><a href="#load_json_probs-398"><span class="linenos">398</span></a><span class="sd">    log-odds probabilities derived from patient records, with one</span>
</span><span id="load_json_probs-399"><a href="#load_json_probs-399"><span class="linenos">399</span></a><span class="sd">    score for each field (column) appearing in the data.</span>
</span><span id="load_json_probs-400"><a href="#load_json_probs-400"><span class="linenos">400</span></a>
</span><span id="load_json_probs-401"><a href="#load_json_probs-401"><span class="linenos">401</span></a><span class="sd">    :param path: The file path to load the data from.</span>
</span><span id="load_json_probs-402"><a href="#load_json_probs-402"><span class="linenos">402</span></a><span class="sd">    :return: A dictionary of probability scores, one for each field</span>
</span><span id="load_json_probs-403"><a href="#load_json_probs-403"><span class="linenos">403</span></a><span class="sd">      in the data set on which they were computed.</span>
</span><span id="load_json_probs-404"><a href="#load_json_probs-404"><span class="linenos">404</span></a><span class="sd">    :raises FileNotFoundError: If a file does not exist at the given</span>
</span><span id="load_json_probs-405"><a href="#load_json_probs-405"><span class="linenos">405</span></a><span class="sd">      path.</span>
</span><span id="load_json_probs-406"><a href="#load_json_probs-406"><span class="linenos">406</span></a><span class="sd">    :raises JSONDecodeError: If the file cannot be read as valid JSON.</span>
</span><span id="load_json_probs-407"><a href="#load_json_probs-407"><span class="linenos">407</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="load_json_probs-408"><a href="#load_json_probs-408"><span class="linenos">408</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="load_json_probs-409"><a href="#load_json_probs-409"><span class="linenos">409</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="load_json_probs-410"><a href="#load_json_probs-410"><span class="linenos">410</span></a>            <span class="n">prob_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="load_json_probs-411"><a href="#load_json_probs-411"><span class="linenos">411</span></a>        <span class="k">return</span> <span class="n">prob_dict</span>
</span><span id="load_json_probs-412"><a href="#load_json_probs-412"><span class="linenos">412</span></a>    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="load_json_probs-413"><a href="#load_json_probs-413"><span class="linenos">413</span></a>        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The specified file does not exist at </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="load_json_probs-414"><a href="#load_json_probs-414"><span class="linenos">414</span></a>    <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="load_json_probs-415"><a href="#load_json_probs-415"><span class="linenos">415</span></a>        <span class="k">raise</span> <span class="n">json</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">(</span>
</span><span id="load_json_probs-416"><a href="#load_json_probs-416"><span class="linenos">416</span></a>            <span class="s2">&quot;The specified file is not valid JSON.&quot;</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">doc</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">pos</span>
</span><span id="load_json_probs-417"><a href="#load_json_probs-417"><span class="linenos">417</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Load a dictionary of probabilities from a JSON-formatted file.
The probabilities correspond to previously computed m-, u-, or
log-odds probabilities derived from patient records, with one
score for each field (column) appearing in the data.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>path</strong>:  The file path to load the data from.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>A dictionary of probability scores, one for each field
    in the data set on which they were computed.</p>
</blockquote>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>FileNotFoundError</strong>:  If a file does not exist at the given
path.</li>
<li><strong>JSONDecodeError</strong>:  If the file cannot be read as valid JSON.</li>
</ul>
</div>


                </section>
                <section id="calculate_log_odds">
                            <input id="calculate_log_odds-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">calculate_log_odds</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">m_probs</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">u_probs</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">file_to_write</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="calculate_log_odds-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#calculate_log_odds"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="calculate_log_odds-37"><a href="#calculate_log_odds-37"><span class="linenos">37</span></a><span class="k">def</span> <span class="nf">calculate_log_odds</span><span class="p">(</span>
</span><span id="calculate_log_odds-38"><a href="#calculate_log_odds-38"><span class="linenos">38</span></a>    <span class="n">m_probs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="calculate_log_odds-39"><a href="#calculate_log_odds-39"><span class="linenos">39</span></a>    <span class="n">u_probs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="calculate_log_odds-40"><a href="#calculate_log_odds-40"><span class="linenos">40</span></a>    <span class="n">file_to_write</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="calculate_log_odds-41"><a href="#calculate_log_odds-41"><span class="linenos">41</span></a><span class="p">):</span>
</span><span id="calculate_log_odds-42"><a href="#calculate_log_odds-42"><span class="linenos">42</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="calculate_log_odds-43"><a href="#calculate_log_odds-43"><span class="linenos">43</span></a><span class="sd">    Calculate the per-field log odds ratio score that two records will</span>
</span><span id="calculate_log_odds-44"><a href="#calculate_log_odds-44"><span class="linenos">44</span></a><span class="sd">    match in a given field. Measures the likelihood that two records</span>
</span><span id="calculate_log_odds-45"><a href="#calculate_log_odds-45"><span class="linenos">45</span></a><span class="sd">    match on a column due to being a true match as opposed to random</span>
</span><span id="calculate_log_odds-46"><a href="#calculate_log_odds-46"><span class="linenos">46</span></a><span class="sd">    chance.</span>
</span><span id="calculate_log_odds-47"><a href="#calculate_log_odds-47"><span class="linenos">47</span></a>
</span><span id="calculate_log_odds-48"><a href="#calculate_log_odds-48"><span class="linenos">48</span></a><span class="sd">    :param m_probs: A dictionary of m-probabilities computed per field.</span>
</span><span id="calculate_log_odds-49"><a href="#calculate_log_odds-49"><span class="linenos">49</span></a><span class="sd">    :param u_probs: A dictionary of u_probabilities computed per field.</span>
</span><span id="calculate_log_odds-50"><a href="#calculate_log_odds-50"><span class="linenos">50</span></a><span class="sd">    :param file_to_write: Optionally, a destination filepath at which</span>
</span><span id="calculate_log_odds-51"><a href="#calculate_log_odds-51"><span class="linenos">51</span></a><span class="sd">      to write the probabilities in JSON format. Default is None.</span>
</span><span id="calculate_log_odds-52"><a href="#calculate_log_odds-52"><span class="linenos">52</span></a><span class="sd">    :raises ValueError: If the supplied m- and u- probability dictionaries</span>
</span><span id="calculate_log_odds-53"><a href="#calculate_log_odds-53"><span class="linenos">53</span></a><span class="sd">      do not share an equal key set.</span>
</span><span id="calculate_log_odds-54"><a href="#calculate_log_odds-54"><span class="linenos">54</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="calculate_log_odds-55"><a href="#calculate_log_odds-55"><span class="linenos">55</span></a>    <span class="k">if</span> <span class="n">m_probs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">!=</span> <span class="n">u_probs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="calculate_log_odds-56"><a href="#calculate_log_odds-56"><span class="linenos">56</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="calculate_log_odds-57"><a href="#calculate_log_odds-57"><span class="linenos">57</span></a>            <span class="s2">&quot;m- and u- probability dictionaries must contain the same set of keys&quot;</span>
</span><span id="calculate_log_odds-58"><a href="#calculate_log_odds-58"><span class="linenos">58</span></a>        <span class="p">)</span>
</span><span id="calculate_log_odds-59"><a href="#calculate_log_odds-59"><span class="linenos">59</span></a>    <span class="n">log_odds</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="calculate_log_odds-60"><a href="#calculate_log_odds-60"><span class="linenos">60</span></a>    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">m_probs</span><span class="p">:</span>
</span><span id="calculate_log_odds-61"><a href="#calculate_log_odds-61"><span class="linenos">61</span></a>        <span class="n">log_odds</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">m_probs</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">-</span> <span class="n">log</span><span class="p">(</span><span class="n">u_probs</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
</span><span id="calculate_log_odds-62"><a href="#calculate_log_odds-62"><span class="linenos">62</span></a>    <span class="n">_write_prob_file</span><span class="p">(</span><span class="n">log_odds</span><span class="p">,</span> <span class="n">file_to_write</span><span class="p">)</span>
</span><span id="calculate_log_odds-63"><a href="#calculate_log_odds-63"><span class="linenos">63</span></a>    <span class="k">return</span> <span class="n">log_odds</span>
</span></pre></div>


            <div class="docstring"><p>Calculate the per-field log odds ratio score that two records will
match in a given field. Measures the likelihood that two records
match on a column due to being a true match as opposed to random
chance.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>m_probs</strong>:  A dictionary of m-probabilities computed per field.</li>
<li><strong>u_probs</strong>:  A dictionary of u_probabilities computed per field.</li>
<li><strong>file_to_write</strong>:  Optionally, a destination filepath at which
to write the probabilities in JSON format. Default is None.</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>:  If the supplied m- and u- probability dictionaries
do not share an equal key set.</li>
</ul>
</div>


                </section>
                <section id="feature_match_log_odds_exact">
                            <input id="feature_match_log_odds_exact-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">feature_match_log_odds_exact</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">record_i</span><span class="p">:</span> <span class="n">List</span>, </span><span class="param"><span class="n">record_j</span><span class="p">:</span> <span class="n">List</span>, </span><span class="param"><span class="n">feature_x</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="feature_match_log_odds_exact-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#feature_match_log_odds_exact"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="feature_match_log_odds_exact-323"><a href="#feature_match_log_odds_exact-323"><span class="linenos">323</span></a><span class="k">def</span> <span class="nf">feature_match_log_odds_exact</span><span class="p">(</span>
</span><span id="feature_match_log_odds_exact-324"><a href="#feature_match_log_odds_exact-324"><span class="linenos">324</span></a>    <span class="n">record_i</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">record_j</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">feature_x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span>
</span><span id="feature_match_log_odds_exact-325"><a href="#feature_match_log_odds_exact-325"><span class="linenos">325</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="feature_match_log_odds_exact-326"><a href="#feature_match_log_odds_exact-326"><span class="linenos">326</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="feature_match_log_odds_exact-327"><a href="#feature_match_log_odds_exact-327"><span class="linenos">327</span></a><span class="sd">    Determines whether two feature values in two records should earn the full</span>
</span><span id="feature_match_log_odds_exact-328"><a href="#feature_match_log_odds_exact-328"><span class="linenos">328</span></a><span class="sd">    log-odds similarity score (i.e. they match exactly) or whether they</span>
</span><span id="feature_match_log_odds_exact-329"><a href="#feature_match_log_odds_exact-329"><span class="linenos">329</span></a><span class="sd">    should earn no weight (they differ). Used for fields for which fuzzy</span>
</span><span id="feature_match_log_odds_exact-330"><a href="#feature_match_log_odds_exact-330"><span class="linenos">330</span></a><span class="sd">    comparisons are inappropriate, such as sex.</span>
</span><span id="feature_match_log_odds_exact-331"><a href="#feature_match_log_odds_exact-331"><span class="linenos">331</span></a>
</span><span id="feature_match_log_odds_exact-332"><a href="#feature_match_log_odds_exact-332"><span class="linenos">332</span></a><span class="sd">    :param record_i: One of the records in the candidate pair to evaluate.</span>
</span><span id="feature_match_log_odds_exact-333"><a href="#feature_match_log_odds_exact-333"><span class="linenos">333</span></a><span class="sd">    :param record_j: The second record in the candidate pair.</span>
</span><span id="feature_match_log_odds_exact-334"><a href="#feature_match_log_odds_exact-334"><span class="linenos">334</span></a><span class="sd">    :param feature_x: A number representing the index of the feature to</span>
</span><span id="feature_match_log_odds_exact-335"><a href="#feature_match_log_odds_exact-335"><span class="linenos">335</span></a><span class="sd">      compare for a partial match.</span>
</span><span id="feature_match_log_odds_exact-336"><a href="#feature_match_log_odds_exact-336"><span class="linenos">336</span></a><span class="sd">    :return: A float of the score the feature comparison earned.</span>
</span><span id="feature_match_log_odds_exact-337"><a href="#feature_match_log_odds_exact-337"><span class="linenos">337</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="feature_match_log_odds_exact-338"><a href="#feature_match_log_odds_exact-338"><span class="linenos">338</span></a>    <span class="k">if</span> <span class="s2">&quot;idx_to_col&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="feature_match_log_odds_exact-339"><a href="#feature_match_log_odds_exact-339"><span class="linenos">339</span></a>        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Mapping of indices to column names must be provided.&quot;</span><span class="p">)</span>
</span><span id="feature_match_log_odds_exact-340"><a href="#feature_match_log_odds_exact-340"><span class="linenos">340</span></a>    <span class="k">if</span> <span class="s2">&quot;log_odds&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="feature_match_log_odds_exact-341"><a href="#feature_match_log_odds_exact-341"><span class="linenos">341</span></a>        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Mapping of columns to m/u log-odds must be provided.&quot;</span><span class="p">)</span>
</span><span id="feature_match_log_odds_exact-342"><a href="#feature_match_log_odds_exact-342"><span class="linenos">342</span></a>    <span class="n">col</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;idx_to_col&quot;</span><span class="p">][</span><span class="n">feature_x</span><span class="p">]</span>
</span><span id="feature_match_log_odds_exact-343"><a href="#feature_match_log_odds_exact-343"><span class="linenos">343</span></a>    <span class="n">col_odds</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;log_odds&quot;</span><span class="p">][</span><span class="n">col</span><span class="p">]</span>
</span><span id="feature_match_log_odds_exact-344"><a href="#feature_match_log_odds_exact-344"><span class="linenos">344</span></a>    <span class="k">if</span> <span class="n">record_i</span><span class="p">[</span><span class="n">feature_x</span><span class="p">]</span> <span class="o">==</span> <span class="n">record_j</span><span class="p">[</span><span class="n">feature_x</span><span class="p">]:</span>
</span><span id="feature_match_log_odds_exact-345"><a href="#feature_match_log_odds_exact-345"><span class="linenos">345</span></a>        <span class="k">return</span> <span class="n">col_odds</span>
</span><span id="feature_match_log_odds_exact-346"><a href="#feature_match_log_odds_exact-346"><span class="linenos">346</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="feature_match_log_odds_exact-347"><a href="#feature_match_log_odds_exact-347"><span class="linenos">347</span></a>        <span class="k">return</span> <span class="mf">0.0</span>
</span></pre></div>


            <div class="docstring"><p>Determines whether two feature values in two records should earn the full
log-odds similarity score (i.e. they match exactly) or whether they
should earn no weight (they differ). Used for fields for which fuzzy
comparisons are inappropriate, such as sex.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>record_i</strong>:  One of the records in the candidate pair to evaluate.</li>
<li><strong>record_j</strong>:  The second record in the candidate pair.</li>
<li><strong>feature_x</strong>:  A number representing the index of the feature to
compare for a partial match.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>A float of the score the feature comparison earned.</p>
</blockquote>
</div>


                </section>
                <section id="feature_match_log_odds_fuzzy_compare">
                            <input id="feature_match_log_odds_fuzzy_compare-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">feature_match_log_odds_fuzzy_compare</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">record_i</span><span class="p">:</span> <span class="n">List</span>, </span><span class="param"><span class="n">record_j</span><span class="p">:</span> <span class="n">List</span>, </span><span class="param"><span class="n">feature_x</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="feature_match_log_odds_fuzzy_compare-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#feature_match_log_odds_fuzzy_compare"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="feature_match_log_odds_fuzzy_compare-350"><a href="#feature_match_log_odds_fuzzy_compare-350"><span class="linenos">350</span></a><span class="k">def</span> <span class="nf">feature_match_log_odds_fuzzy_compare</span><span class="p">(</span>
</span><span id="feature_match_log_odds_fuzzy_compare-351"><a href="#feature_match_log_odds_fuzzy_compare-351"><span class="linenos">351</span></a>    <span class="n">record_i</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">record_j</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">feature_x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span>
</span><span id="feature_match_log_odds_fuzzy_compare-352"><a href="#feature_match_log_odds_fuzzy_compare-352"><span class="linenos">352</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="feature_match_log_odds_fuzzy_compare-353"><a href="#feature_match_log_odds_fuzzy_compare-353"><span class="linenos">353</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="feature_match_log_odds_fuzzy_compare-354"><a href="#feature_match_log_odds_fuzzy_compare-354"><span class="linenos">354</span></a><span class="sd">    Determines the weighted string-odds similarly score earned by two</span>
</span><span id="feature_match_log_odds_fuzzy_compare-355"><a href="#feature_match_log_odds_fuzzy_compare-355"><span class="linenos">355</span></a><span class="sd">    feature values in two records, as a function of the pre-computed</span>
</span><span id="feature_match_log_odds_fuzzy_compare-356"><a href="#feature_match_log_odds_fuzzy_compare-356"><span class="linenos">356</span></a><span class="sd">    log-odds weights and the string similarity between the two features.</span>
</span><span id="feature_match_log_odds_fuzzy_compare-357"><a href="#feature_match_log_odds_fuzzy_compare-357"><span class="linenos">357</span></a><span class="sd">    This scales the full score that would be earned from a perfect</span>
</span><span id="feature_match_log_odds_fuzzy_compare-358"><a href="#feature_match_log_odds_fuzzy_compare-358"><span class="linenos">358</span></a><span class="sd">    match to a degree of partial weight appropriate to how similar the</span>
</span><span id="feature_match_log_odds_fuzzy_compare-359"><a href="#feature_match_log_odds_fuzzy_compare-359"><span class="linenos">359</span></a><span class="sd">    two strings are.</span>
</span><span id="feature_match_log_odds_fuzzy_compare-360"><a href="#feature_match_log_odds_fuzzy_compare-360"><span class="linenos">360</span></a>
</span><span id="feature_match_log_odds_fuzzy_compare-361"><a href="#feature_match_log_odds_fuzzy_compare-361"><span class="linenos">361</span></a><span class="sd">    :param record_i: One of the records in the candidate pair to evaluate.</span>
</span><span id="feature_match_log_odds_fuzzy_compare-362"><a href="#feature_match_log_odds_fuzzy_compare-362"><span class="linenos">362</span></a><span class="sd">    :param record_j: The second record in the candidate pair.</span>
</span><span id="feature_match_log_odds_fuzzy_compare-363"><a href="#feature_match_log_odds_fuzzy_compare-363"><span class="linenos">363</span></a><span class="sd">    :param feature_x: A number representing the index of the feature to</span>
</span><span id="feature_match_log_odds_fuzzy_compare-364"><a href="#feature_match_log_odds_fuzzy_compare-364"><span class="linenos">364</span></a><span class="sd">      compare for a partial match.</span>
</span><span id="feature_match_log_odds_fuzzy_compare-365"><a href="#feature_match_log_odds_fuzzy_compare-365"><span class="linenos">365</span></a><span class="sd">    :return: A float of the score the feature comparison earned.</span>
</span><span id="feature_match_log_odds_fuzzy_compare-366"><a href="#feature_match_log_odds_fuzzy_compare-366"><span class="linenos">366</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="feature_match_log_odds_fuzzy_compare-367"><a href="#feature_match_log_odds_fuzzy_compare-367"><span class="linenos">367</span></a>    <span class="k">if</span> <span class="s2">&quot;idx_to_col&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="feature_match_log_odds_fuzzy_compare-368"><a href="#feature_match_log_odds_fuzzy_compare-368"><span class="linenos">368</span></a>        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Mapping of indices to column names must be provided.&quot;</span><span class="p">)</span>
</span><span id="feature_match_log_odds_fuzzy_compare-369"><a href="#feature_match_log_odds_fuzzy_compare-369"><span class="linenos">369</span></a>    <span class="k">if</span> <span class="s2">&quot;log_odds&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="feature_match_log_odds_fuzzy_compare-370"><a href="#feature_match_log_odds_fuzzy_compare-370"><span class="linenos">370</span></a>        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Mapping of columns to m/u log-odds must be provided.&quot;</span><span class="p">)</span>
</span><span id="feature_match_log_odds_fuzzy_compare-371"><a href="#feature_match_log_odds_fuzzy_compare-371"><span class="linenos">371</span></a>    <span class="n">col</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;idx_to_col&quot;</span><span class="p">][</span><span class="n">feature_x</span><span class="p">]</span>
</span><span id="feature_match_log_odds_fuzzy_compare-372"><a href="#feature_match_log_odds_fuzzy_compare-372"><span class="linenos">372</span></a>    <span class="n">col_odds</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;log_odds&quot;</span><span class="p">][</span><span class="n">col</span><span class="p">]</span>
</span><span id="feature_match_log_odds_fuzzy_compare-373"><a href="#feature_match_log_odds_fuzzy_compare-373"><span class="linenos">373</span></a>    <span class="n">score</span> <span class="o">=</span> <span class="n">compare_strings</span><span class="p">(</span><span class="n">record_i</span><span class="p">[</span><span class="n">feature_x</span><span class="p">],</span> <span class="n">record_j</span><span class="p">[</span><span class="n">feature_x</span><span class="p">],</span> <span class="s2">&quot;JaroWinkler&quot;</span><span class="p">)</span>
</span><span id="feature_match_log_odds_fuzzy_compare-374"><a href="#feature_match_log_odds_fuzzy_compare-374"><span class="linenos">374</span></a>    <span class="k">return</span> <span class="n">score</span> <span class="o">*</span> <span class="n">col_odds</span>
</span></pre></div>


            <div class="docstring"><p>Determines the weighted string-odds similarly score earned by two
feature values in two records, as a function of the pre-computed
log-odds weights and the string similarity between the two features.
This scales the full score that would be earned from a perfect
match to a degree of partial weight appropriate to how similar the
two strings are.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>record_i</strong>:  One of the records in the candidate pair to evaluate.</li>
<li><strong>record_j</strong>:  The second record in the candidate pair.</li>
<li><strong>feature_x</strong>:  A number representing the index of the feature to
compare for a partial match.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>A float of the score the feature comparison earned.</p>
</blockquote>
</div>


                </section>
                <section id="profile_log_odds">
                            <input id="profile_log_odds-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">profile_log_odds</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	<span class="n">true_matches</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">log_odds</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">exact_cols</span><span class="p">:</span> <span class="n">List</span>,</span><span class="param">	<span class="n">fuzzy_cols</span><span class="p">:</span> <span class="n">List</span>,</span><span class="param">	<span class="n">idx_to_col</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">neg_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50000</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="profile_log_odds-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#profile_log_odds"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="profile_log_odds-535"><a href="#profile_log_odds-535"><span class="linenos">535</span></a><span class="k">def</span> <span class="nf">profile_log_odds</span><span class="p">(</span>
</span><span id="profile_log_odds-536"><a href="#profile_log_odds-536"><span class="linenos">536</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="profile_log_odds-537"><a href="#profile_log_odds-537"><span class="linenos">537</span></a>    <span class="n">true_matches</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="profile_log_odds-538"><a href="#profile_log_odds-538"><span class="linenos">538</span></a>    <span class="n">log_odds</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="profile_log_odds-539"><a href="#profile_log_odds-539"><span class="linenos">539</span></a>    <span class="n">exact_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="profile_log_odds-540"><a href="#profile_log_odds-540"><span class="linenos">540</span></a>    <span class="n">fuzzy_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="profile_log_odds-541"><a href="#profile_log_odds-541"><span class="linenos">541</span></a>    <span class="n">idx_to_col</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="profile_log_odds-542"><a href="#profile_log_odds-542"><span class="linenos">542</span></a>    <span class="n">neg_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span>
</span><span id="profile_log_odds-543"><a href="#profile_log_odds-543"><span class="linenos">543</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
</span><span id="profile_log_odds-544"><a href="#profile_log_odds-544"><span class="linenos">544</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="profile_log_odds-545"><a href="#profile_log_odds-545"><span class="linenos">545</span></a><span class="sd">    Basic graphical profiler for log-odds histogram analysis. Using the</span>
</span><span id="profile_log_odds-546"><a href="#profile_log_odds-546"><span class="linenos">546</span></a><span class="sd">    raw data and previously known true matches, the function computes one</span>
</span><span id="profile_log_odds-547"><a href="#profile_log_odds-547"><span class="linenos">547</span></a><span class="sd">    list of log-odds scores that that would be earned by true matches under</span>
</span><span id="profile_log_odds-548"><a href="#profile_log_odds-548"><span class="linenos">548</span></a><span class="sd">    a given linkage rule, and another list of scores that would be earned</span>
</span><span id="profile_log_odds-549"><a href="#profile_log_odds-549"><span class="linenos">549</span></a><span class="sd">    by a random sampling of non-matches under the same linkage rule. These</span>
</span><span id="profile_log_odds-550"><a href="#profile_log_odds-550"><span class="linenos">550</span></a><span class="sd">    lists are used to plot bimodal histograms so that the cutoff threshold</span>
</span><span id="profile_log_odds-551"><a href="#profile_log_odds-551"><span class="linenos">551</span></a><span class="sd">    between non-matchces and true matches can be visually determined.</span>
</span><span id="profile_log_odds-552"><a href="#profile_log_odds-552"><span class="linenos">552</span></a>
</span><span id="profile_log_odds-553"><a href="#profile_log_odds-553"><span class="linenos">553</span></a><span class="sd">    :param data: A pandas data frame holding the raw patient record data.</span>
</span><span id="profile_log_odds-554"><a href="#profile_log_odds-554"><span class="linenos">554</span></a><span class="sd">    :param true_matches: A dictionary of known true matches in the data.</span>
</span><span id="profile_log_odds-555"><a href="#profile_log_odds-555"><span class="linenos">555</span></a><span class="sd">    :param log_odds: A dictionary whose keys are the column fields of data</span>
</span><span id="profile_log_odds-556"><a href="#profile_log_odds-556"><span class="linenos">556</span></a><span class="sd">      and whose values are the log-odds scores that two values match relative</span>
</span><span id="profile_log_odds-557"><a href="#profile_log_odds-557"><span class="linenos">557</span></a><span class="sd">      to random chance.</span>
</span><span id="profile_log_odds-558"><a href="#profile_log_odds-558"><span class="linenos">558</span></a><span class="sd">    :param exact_cols: A list of columns to be evaluated using equality</span>
</span><span id="profile_log_odds-559"><a href="#profile_log_odds-559"><span class="linenos">559</span></a><span class="sd">      comparisons.</span>
</span><span id="profile_log_odds-560"><a href="#profile_log_odds-560"><span class="linenos">560</span></a><span class="sd">    :param fuzzy_cols: A list of columns to be evaluated using fuzzy weighted</span>
</span><span id="profile_log_odds-561"><a href="#profile_log_odds-561"><span class="linenos">561</span></a><span class="sd">      comparisons.</span>
</span><span id="profile_log_odds-562"><a href="#profile_log_odds-562"><span class="linenos">562</span></a><span class="sd">    :param idx_to_col: A dictionary mapping the number of a column in a list</span>
</span><span id="profile_log_odds-563"><a href="#profile_log_odds-563"><span class="linenos">563</span></a><span class="sd">      representation of the data, to the name of the column in a pandas</span>
</span><span id="profile_log_odds-564"><a href="#profile_log_odds-564"><span class="linenos">564</span></a><span class="sd">      representation.</span>
</span><span id="profile_log_odds-565"><a href="#profile_log_odds-565"><span class="linenos">565</span></a><span class="sd">    :param neg_samples: Optionally, how many non-match samples to compute a</span>
</span><span id="profile_log_odds-566"><a href="#profile_log_odds-566"><span class="linenos">566</span></a><span class="sd">      score for when generating the histogram.</span>
</span><span id="profile_log_odds-567"><a href="#profile_log_odds-567"><span class="linenos">567</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="profile_log_odds-568"><a href="#profile_log_odds-568"><span class="linenos">568</span></a>    <span class="n">base_pairs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="profile_log_odds-569"><a href="#profile_log_odds-569"><span class="linenos">569</span></a>    <span class="n">neg_pairs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="profile_log_odds-570"><a href="#profile_log_odds-570"><span class="linenos">570</span></a>        <span class="n">x</span>
</span><span id="profile_log_odds-571"><a href="#profile_log_odds-571"><span class="linenos">571</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">base_pairs</span>
</span><span id="profile_log_odds-572"><a href="#profile_log_odds-572"><span class="linenos">572</span></a>        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">true_matches</span> <span class="ow">or</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">true_matches</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="profile_log_odds-573"><a href="#profile_log_odds-573"><span class="linenos">573</span></a>    <span class="p">]</span>
</span><span id="profile_log_odds-574"><a href="#profile_log_odds-574"><span class="linenos">574</span></a>    <span class="k">if</span> <span class="n">neg_samples</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">neg_pairs</span><span class="p">):</span>
</span><span id="profile_log_odds-575"><a href="#profile_log_odds-575"><span class="linenos">575</span></a>        <span class="n">neg_pairs</span> <span class="o">=</span> <span class="n">sample</span><span class="p">(</span><span class="n">neg_pairs</span><span class="p">,</span> <span class="n">neg_samples</span><span class="p">)</span>
</span><span id="profile_log_odds-576"><a href="#profile_log_odds-576"><span class="linenos">576</span></a>
</span><span id="profile_log_odds-577"><a href="#profile_log_odds-577"><span class="linenos">577</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="profile_log_odds-578"><a href="#profile_log_odds-578"><span class="linenos">578</span></a>    <span class="n">cols_to_idx</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="profile_log_odds-579"><a href="#profile_log_odds-579"><span class="linenos">579</span></a>    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idx_to_col</span><span class="p">:</span>
</span><span id="profile_log_odds-580"><a href="#profile_log_odds-580"><span class="linenos">580</span></a>        <span class="n">cols_to_idx</span><span class="p">[</span><span class="n">idx_to_col</span><span class="p">[</span><span class="n">idx</span><span class="p">]]</span> <span class="o">=</span> <span class="n">idx</span>
</span><span id="profile_log_odds-581"><a href="#profile_log_odds-581"><span class="linenos">581</span></a>
</span><span id="profile_log_odds-582"><a href="#profile_log_odds-582"><span class="linenos">582</span></a>    <span class="n">true_match_scores</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="profile_log_odds-583"><a href="#profile_log_odds-583"><span class="linenos">583</span></a>    <span class="k">for</span> <span class="n">root_record</span><span class="p">,</span> <span class="n">paired_records</span> <span class="ow">in</span> <span class="n">true_matches</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="profile_log_odds-584"><a href="#profile_log_odds-584"><span class="linenos">584</span></a>        <span class="k">for</span> <span class="n">pr</span> <span class="ow">in</span> <span class="n">paired_records</span><span class="p">:</span>
</span><span id="profile_log_odds-585"><a href="#profile_log_odds-585"><span class="linenos">585</span></a>            <span class="n">score</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="profile_log_odds-586"><a href="#profile_log_odds-586"><span class="linenos">586</span></a>            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">exact_cols</span><span class="p">:</span>
</span><span id="profile_log_odds-587"><a href="#profile_log_odds-587"><span class="linenos">587</span></a>                <span class="n">score</span> <span class="o">+=</span> <span class="n">feature_match_log_odds_exact</span><span class="p">(</span>
</span><span id="profile_log_odds-588"><a href="#profile_log_odds-588"><span class="linenos">588</span></a>                    <span class="n">data</span><span class="p">[</span><span class="n">root_record</span><span class="p">],</span>
</span><span id="profile_log_odds-589"><a href="#profile_log_odds-589"><span class="linenos">589</span></a>                    <span class="n">data</span><span class="p">[</span><span class="n">pr</span><span class="p">],</span>
</span><span id="profile_log_odds-590"><a href="#profile_log_odds-590"><span class="linenos">590</span></a>                    <span class="n">cols_to_idx</span><span class="p">[</span><span class="n">c</span><span class="p">],</span>
</span><span id="profile_log_odds-591"><a href="#profile_log_odds-591"><span class="linenos">591</span></a>                    <span class="n">idx_to_col</span><span class="o">=</span><span class="n">idx_to_col</span><span class="p">,</span>
</span><span id="profile_log_odds-592"><a href="#profile_log_odds-592"><span class="linenos">592</span></a>                    <span class="n">log_odds</span><span class="o">=</span><span class="n">log_odds</span><span class="p">,</span>
</span><span id="profile_log_odds-593"><a href="#profile_log_odds-593"><span class="linenos">593</span></a>                <span class="p">)</span>
</span><span id="profile_log_odds-594"><a href="#profile_log_odds-594"><span class="linenos">594</span></a>            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">fuzzy_cols</span><span class="p">:</span>
</span><span id="profile_log_odds-595"><a href="#profile_log_odds-595"><span class="linenos">595</span></a>                <span class="n">score</span> <span class="o">+=</span> <span class="n">feature_match_log_odds_fuzzy_compare</span><span class="p">(</span>
</span><span id="profile_log_odds-596"><a href="#profile_log_odds-596"><span class="linenos">596</span></a>                    <span class="n">data</span><span class="p">[</span><span class="n">root_record</span><span class="p">],</span>
</span><span id="profile_log_odds-597"><a href="#profile_log_odds-597"><span class="linenos">597</span></a>                    <span class="n">data</span><span class="p">[</span><span class="n">pr</span><span class="p">],</span>
</span><span id="profile_log_odds-598"><a href="#profile_log_odds-598"><span class="linenos">598</span></a>                    <span class="n">cols_to_idx</span><span class="p">[</span><span class="n">c</span><span class="p">],</span>
</span><span id="profile_log_odds-599"><a href="#profile_log_odds-599"><span class="linenos">599</span></a>                    <span class="n">idx_to_col</span><span class="o">=</span><span class="n">idx_to_col</span><span class="p">,</span>
</span><span id="profile_log_odds-600"><a href="#profile_log_odds-600"><span class="linenos">600</span></a>                    <span class="n">log_odds</span><span class="o">=</span><span class="n">log_odds</span><span class="p">,</span>
</span><span id="profile_log_odds-601"><a href="#profile_log_odds-601"><span class="linenos">601</span></a>                <span class="p">)</span>
</span><span id="profile_log_odds-602"><a href="#profile_log_odds-602"><span class="linenos">602</span></a>            <span class="n">true_match_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
</span><span id="profile_log_odds-603"><a href="#profile_log_odds-603"><span class="linenos">603</span></a>
</span><span id="profile_log_odds-604"><a href="#profile_log_odds-604"><span class="linenos">604</span></a>    <span class="n">non_match_scores</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="profile_log_odds-605"><a href="#profile_log_odds-605"><span class="linenos">605</span></a>    <span class="k">for</span> <span class="n">record_1</span><span class="p">,</span> <span class="n">record_2</span> <span class="ow">in</span> <span class="n">neg_pairs</span><span class="p">:</span>
</span><span id="profile_log_odds-606"><a href="#profile_log_odds-606"><span class="linenos">606</span></a>        <span class="n">score</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="profile_log_odds-607"><a href="#profile_log_odds-607"><span class="linenos">607</span></a>        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">exact_cols</span><span class="p">:</span>
</span><span id="profile_log_odds-608"><a href="#profile_log_odds-608"><span class="linenos">608</span></a>            <span class="n">score</span> <span class="o">+=</span> <span class="n">feature_match_log_odds_exact</span><span class="p">(</span>
</span><span id="profile_log_odds-609"><a href="#profile_log_odds-609"><span class="linenos">609</span></a>                <span class="n">data</span><span class="p">[</span><span class="n">record_1</span><span class="p">],</span>
</span><span id="profile_log_odds-610"><a href="#profile_log_odds-610"><span class="linenos">610</span></a>                <span class="n">data</span><span class="p">[</span><span class="n">record_2</span><span class="p">],</span>
</span><span id="profile_log_odds-611"><a href="#profile_log_odds-611"><span class="linenos">611</span></a>                <span class="n">cols_to_idx</span><span class="p">[</span><span class="n">c</span><span class="p">],</span>
</span><span id="profile_log_odds-612"><a href="#profile_log_odds-612"><span class="linenos">612</span></a>                <span class="n">idx_to_col</span><span class="o">=</span><span class="n">idx_to_col</span><span class="p">,</span>
</span><span id="profile_log_odds-613"><a href="#profile_log_odds-613"><span class="linenos">613</span></a>                <span class="n">log_odds</span><span class="o">=</span><span class="n">log_odds</span><span class="p">,</span>
</span><span id="profile_log_odds-614"><a href="#profile_log_odds-614"><span class="linenos">614</span></a>            <span class="p">)</span>
</span><span id="profile_log_odds-615"><a href="#profile_log_odds-615"><span class="linenos">615</span></a>        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">fuzzy_cols</span><span class="p">:</span>
</span><span id="profile_log_odds-616"><a href="#profile_log_odds-616"><span class="linenos">616</span></a>            <span class="n">score</span> <span class="o">+=</span> <span class="n">feature_match_log_odds_fuzzy_compare</span><span class="p">(</span>
</span><span id="profile_log_odds-617"><a href="#profile_log_odds-617"><span class="linenos">617</span></a>                <span class="n">data</span><span class="p">[</span><span class="n">record_1</span><span class="p">],</span>
</span><span id="profile_log_odds-618"><a href="#profile_log_odds-618"><span class="linenos">618</span></a>                <span class="n">data</span><span class="p">[</span><span class="n">record_2</span><span class="p">],</span>
</span><span id="profile_log_odds-619"><a href="#profile_log_odds-619"><span class="linenos">619</span></a>                <span class="n">cols_to_idx</span><span class="p">[</span><span class="n">c</span><span class="p">],</span>
</span><span id="profile_log_odds-620"><a href="#profile_log_odds-620"><span class="linenos">620</span></a>                <span class="n">idx_to_col</span><span class="o">=</span><span class="n">idx_to_col</span><span class="p">,</span>
</span><span id="profile_log_odds-621"><a href="#profile_log_odds-621"><span class="linenos">621</span></a>                <span class="n">log_odds</span><span class="o">=</span><span class="n">log_odds</span><span class="p">,</span>
</span><span id="profile_log_odds-622"><a href="#profile_log_odds-622"><span class="linenos">622</span></a>            <span class="p">)</span>
</span><span id="profile_log_odds-623"><a href="#profile_log_odds-623"><span class="linenos">623</span></a>            <span class="n">non_match_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
</span><span id="profile_log_odds-624"><a href="#profile_log_odds-624"><span class="linenos">624</span></a>
</span><span id="profile_log_odds-625"><a href="#profile_log_odds-625"><span class="linenos">625</span></a>    <span class="n">min_length</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">true_match_scores</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">non_match_scores</span><span class="p">))</span>
</span><span id="profile_log_odds-626"><a href="#profile_log_odds-626"><span class="linenos">626</span></a>    <span class="n">true_match_scores</span> <span class="o">=</span> <span class="n">true_match_scores</span><span class="p">[:</span><span class="n">min_length</span><span class="p">]</span>
</span><span id="profile_log_odds-627"><a href="#profile_log_odds-627"><span class="linenos">627</span></a>    <span class="n">non_match_scores</span> <span class="o">=</span> <span class="n">non_match_scores</span><span class="p">[:</span><span class="n">min_length</span><span class="p">]</span>
</span><span id="profile_log_odds-628"><a href="#profile_log_odds-628"><span class="linenos">628</span></a>
</span><span id="profile_log_odds-629"><a href="#profile_log_odds-629"><span class="linenos">629</span></a>    <span class="n">_</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">true_match_scores</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">])</span>
</span><span id="profile_log_odds-630"><a href="#profile_log_odds-630"><span class="linenos">630</span></a>    <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">non_match_scores</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="profile_log_odds-631"><a href="#profile_log_odds-631"><span class="linenos">631</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Basic graphical profiler for log-odds histogram analysis. Using the
raw data and previously known true matches, the function computes one
list of log-odds scores that that would be earned by true matches under
a given linkage rule, and another list of scores that would be earned
by a random sampling of non-matches under the same linkage rule. These
lists are used to plot bimodal histograms so that the cutoff threshold
between non-matchces and true matches can be visually determined.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>data</strong>:  A pandas data frame holding the raw patient record data.</li>
<li><strong>true_matches</strong>:  A dictionary of known true matches in the data.</li>
<li><strong>log_odds</strong>:  A dictionary whose keys are the column fields of data
and whose values are the log-odds scores that two values match relative
to random chance.</li>
<li><strong>exact_cols</strong>:  A list of columns to be evaluated using equality
comparisons.</li>
<li><strong>fuzzy_cols</strong>:  A list of columns to be evaluated using fuzzy weighted
comparisons.</li>
<li><strong>idx_to_col</strong>:  A dictionary mapping the number of a column in a list
representation of the data, to the name of the column in a pandas
representation.</li>
<li><strong>neg_samples</strong>:  Optionally, how many non-match samples to compute a
score for when generating the histogram.</li>
</ul>
</div>


                </section>
                <section id="eval_log_odds_cutoff">
                            <input id="eval_log_odds_cutoff-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">eval_log_odds_cutoff</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">feature_comparisons</span><span class="p">:</span> <span class="n">List</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="eval_log_odds_cutoff-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#eval_log_odds_cutoff"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="eval_log_odds_cutoff-235"><a href="#eval_log_odds_cutoff-235"><span class="linenos">235</span></a><span class="k">def</span> <span class="nf">eval_log_odds_cutoff</span><span class="p">(</span><span class="n">feature_comparisons</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="eval_log_odds_cutoff-236"><a href="#eval_log_odds_cutoff-236"><span class="linenos">236</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="eval_log_odds_cutoff-237"><a href="#eval_log_odds_cutoff-237"><span class="linenos">237</span></a><span class="sd">    Determines whether a given set of feature comparisons matches enough</span>
</span><span id="eval_log_odds_cutoff-238"><a href="#eval_log_odds_cutoff-238"><span class="linenos">238</span></a><span class="sd">    to be the result of a true patient link instead of just random chance.</span>
</span><span id="eval_log_odds_cutoff-239"><a href="#eval_log_odds_cutoff-239"><span class="linenos">239</span></a><span class="sd">    This is represented using previously computed log-odds ratios.</span>
</span><span id="eval_log_odds_cutoff-240"><a href="#eval_log_odds_cutoff-240"><span class="linenos">240</span></a>
</span><span id="eval_log_odds_cutoff-241"><a href="#eval_log_odds_cutoff-241"><span class="linenos">241</span></a><span class="sd">    :param feature_comparisons: A list of floats representing the log-odds</span>
</span><span id="eval_log_odds_cutoff-242"><a href="#eval_log_odds_cutoff-242"><span class="linenos">242</span></a><span class="sd">      score of each field computed on.</span>
</span><span id="eval_log_odds_cutoff-243"><a href="#eval_log_odds_cutoff-243"><span class="linenos">243</span></a><span class="sd">    :return: Whether the feature comparisons score well enough to be</span>
</span><span id="eval_log_odds_cutoff-244"><a href="#eval_log_odds_cutoff-244"><span class="linenos">244</span></a><span class="sd">      considered a match.</span>
</span><span id="eval_log_odds_cutoff-245"><a href="#eval_log_odds_cutoff-245"><span class="linenos">245</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="eval_log_odds_cutoff-246"><a href="#eval_log_odds_cutoff-246"><span class="linenos">246</span></a>    <span class="k">if</span> <span class="s2">&quot;true_match_threshold&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="eval_log_odds_cutoff-247"><a href="#eval_log_odds_cutoff-247"><span class="linenos">247</span></a>        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Cutoff threshold for true matches must be passed.&quot;</span><span class="p">)</span>
</span><span id="eval_log_odds_cutoff-248"><a href="#eval_log_odds_cutoff-248"><span class="linenos">248</span></a>    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">feature_comparisons</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;true_match_threshold&quot;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Determines whether a given set of feature comparisons matches enough
to be the result of a true patient link instead of just random chance.
This is represented using previously computed log-odds ratios.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>feature_comparisons</strong>:  A list of floats representing the log-odds
score of each field computed on.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Whether the feature comparisons score well enough to be
    considered a match.</p>
</blockquote>
</div>


                </section>
                <section id="BaseMPIConnectorClient">
                            <input id="BaseMPIConnectorClient-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">BaseMPIConnectorClient</span><wbr>(<span class="base">abc.ABC</span>):

                <label class="view-source-button" for="BaseMPIConnectorClient-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseMPIConnectorClient"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseMPIConnectorClient-6"><a href="#BaseMPIConnectorClient-6"><span class="linenos"> 6</span></a><span class="k">class</span> <span class="nc">BaseMPIConnectorClient</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="BaseMPIConnectorClient-7"><a href="#BaseMPIConnectorClient-7"><span class="linenos"> 7</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="BaseMPIConnectorClient-8"><a href="#BaseMPIConnectorClient-8"><span class="linenos"> 8</span></a><span class="sd">    Represents a vendor-agnostic Master Patient Index (MPI) connector client. Requires</span>
</span><span id="BaseMPIConnectorClient-9"><a href="#BaseMPIConnectorClient-9"><span class="linenos"> 9</span></a><span class="sd">    implementing classes to define methods to retrive blocks of data from the MPI.</span>
</span><span id="BaseMPIConnectorClient-10"><a href="#BaseMPIConnectorClient-10"><span class="linenos">10</span></a><span class="sd">    Callers should use the provided interface functions (e.g., geocode_from_str)</span>
</span><span id="BaseMPIConnectorClient-11"><a href="#BaseMPIConnectorClient-11"><span class="linenos">11</span></a><span class="sd">    to interact with the underlying vendor-specific client property.</span>
</span><span id="BaseMPIConnectorClient-12"><a href="#BaseMPIConnectorClient-12"><span class="linenos">12</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="BaseMPIConnectorClient-13"><a href="#BaseMPIConnectorClient-13"><span class="linenos">13</span></a>
</span><span id="BaseMPIConnectorClient-14"><a href="#BaseMPIConnectorClient-14"><span class="linenos">14</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="BaseMPIConnectorClient-15"><a href="#BaseMPIConnectorClient-15"><span class="linenos">15</span></a>    <span class="k">def</span> <span class="nf">block_data</span><span class="p">(</span><span class="n">db_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">block_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">list</span><span class="p">]:</span>
</span><span id="BaseMPIConnectorClient-16"><a href="#BaseMPIConnectorClient-16"><span class="linenos">16</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="BaseMPIConnectorClient-17"><a href="#BaseMPIConnectorClient-17"><span class="linenos">17</span></a><span class="sd">        Returns a list of lists containing records from the database that match on the</span>
</span><span id="BaseMPIConnectorClient-18"><a href="#BaseMPIConnectorClient-18"><span class="linenos">18</span></a><span class="sd">        incoming record&#39;s block values. If blocking on &#39;ZIP&#39; and the incoming record&#39;s</span>
</span><span id="BaseMPIConnectorClient-19"><a href="#BaseMPIConnectorClient-19"><span class="linenos">19</span></a><span class="sd">        zip code is &#39;90210&#39;, the resulting block of data would contain records that all</span>
</span><span id="BaseMPIConnectorClient-20"><a href="#BaseMPIConnectorClient-20"><span class="linenos">20</span></a><span class="sd">        have the same zip code of 90210.</span>
</span><span id="BaseMPIConnectorClient-21"><a href="#BaseMPIConnectorClient-21"><span class="linenos">21</span></a>
</span><span id="BaseMPIConnectorClient-22"><a href="#BaseMPIConnectorClient-22"><span class="linenos">22</span></a><span class="sd">        :param db_name: Database name.</span>
</span><span id="BaseMPIConnectorClient-23"><a href="#BaseMPIConnectorClient-23"><span class="linenos">23</span></a><span class="sd">        :param table_name: Table name.</span>
</span><span id="BaseMPIConnectorClient-24"><a href="#BaseMPIConnectorClient-24"><span class="linenos">24</span></a><span class="sd">        :param block_data: Dictionary containing key value pairs for the column name for</span>
</span><span id="BaseMPIConnectorClient-25"><a href="#BaseMPIConnectorClient-25"><span class="linenos">25</span></a><span class="sd">        blocking and the data for the incoming record, e.g., [&quot;ZIP&quot;]: &quot;90210&quot;.</span>
</span><span id="BaseMPIConnectorClient-26"><a href="#BaseMPIConnectorClient-26"><span class="linenos">26</span></a><span class="sd">        :return: A list of records that are within the block, e.g., records that all</span>
</span><span id="BaseMPIConnectorClient-27"><a href="#BaseMPIConnectorClient-27"><span class="linenos">27</span></a><span class="sd">        have 90210 as their ZIP.</span>
</span><span id="BaseMPIConnectorClient-28"><a href="#BaseMPIConnectorClient-28"><span class="linenos">28</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BaseMPIConnectorClient-29"><a href="#BaseMPIConnectorClient-29"><span class="linenos">29</span></a>        <span class="k">pass</span>  <span class="c1"># pragma: no cover</span>
</span><span id="BaseMPIConnectorClient-30"><a href="#BaseMPIConnectorClient-30"><span class="linenos">30</span></a>
</span><span id="BaseMPIConnectorClient-31"><a href="#BaseMPIConnectorClient-31"><span class="linenos">31</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="BaseMPIConnectorClient-32"><a href="#BaseMPIConnectorClient-32"><span class="linenos">32</span></a>    <span class="k">def</span> <span class="nf">upsert_match_patient</span><span class="p">(</span>
</span><span id="BaseMPIConnectorClient-33"><a href="#BaseMPIConnectorClient-33"><span class="linenos">33</span></a>        <span class="n">patient_record</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="BaseMPIConnectorClient-34"><a href="#BaseMPIConnectorClient-34"><span class="linenos">34</span></a>        <span class="n">patient_table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="BaseMPIConnectorClient-35"><a href="#BaseMPIConnectorClient-35"><span class="linenos">35</span></a>        <span class="n">person_table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="BaseMPIConnectorClient-36"><a href="#BaseMPIConnectorClient-36"><span class="linenos">36</span></a>        <span class="n">person_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="BaseMPIConnectorClient-37"><a href="#BaseMPIConnectorClient-37"><span class="linenos">37</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="BaseMPIConnectorClient-38"><a href="#BaseMPIConnectorClient-38"><span class="linenos">38</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="BaseMPIConnectorClient-39"><a href="#BaseMPIConnectorClient-39"><span class="linenos">39</span></a><span class="sd">        If a matching person ID has been found in the MPI, inserts a new patient into</span>
</span><span id="BaseMPIConnectorClient-40"><a href="#BaseMPIConnectorClient-40"><span class="linenos">40</span></a><span class="sd">        the patient table and updates the person table to link to the new patient; else</span>
</span><span id="BaseMPIConnectorClient-41"><a href="#BaseMPIConnectorClient-41"><span class="linenos">41</span></a><span class="sd">        inserts a new patient into the patient table and inserts a new person into the</span>
</span><span id="BaseMPIConnectorClient-42"><a href="#BaseMPIConnectorClient-42"><span class="linenos">42</span></a><span class="sd">        person table with a new personID, linking the new personID to the new patient.</span>
</span><span id="BaseMPIConnectorClient-43"><a href="#BaseMPIConnectorClient-43"><span class="linenos">43</span></a>
</span><span id="BaseMPIConnectorClient-44"><a href="#BaseMPIConnectorClient-44"><span class="linenos">44</span></a><span class="sd">        :param patient_record: A FHIR patient resource.</span>
</span><span id="BaseMPIConnectorClient-45"><a href="#BaseMPIConnectorClient-45"><span class="linenos">45</span></a><span class="sd">        :param patient_table_name: Name of patient table to update or insert into.</span>
</span><span id="BaseMPIConnectorClient-46"><a href="#BaseMPIConnectorClient-46"><span class="linenos">46</span></a><span class="sd">        :param person_table_name: Name of person table to update or insert into.</span>
</span><span id="BaseMPIConnectorClient-47"><a href="#BaseMPIConnectorClient-47"><span class="linenos">47</span></a><span class="sd">        :param person_id: The personID matching the patient record if a match has been</span>
</span><span id="BaseMPIConnectorClient-48"><a href="#BaseMPIConnectorClient-48"><span class="linenos">48</span></a><span class="sd">        found in the MPI, defaults to None.</span>
</span><span id="BaseMPIConnectorClient-49"><a href="#BaseMPIConnectorClient-49"><span class="linenos">49</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BaseMPIConnectorClient-50"><a href="#BaseMPIConnectorClient-50"><span class="linenos">50</span></a>        <span class="k">pass</span>  <span class="c1"># pragma: no cover</span>
</span></pre></div>


            <div class="docstring"><p>Represents a vendor-agnostic Master Patient Index (MPI) connector client. Requires
implementing classes to define methods to retrive blocks of data from the MPI.
Callers should use the provided interface functions (e.g., geocode_from_str)
to interact with the underlying vendor-specific client property.</p>
</div>


                            <div id="BaseMPIConnectorClient.block_data" class="classattr">
                                        <input id="BaseMPIConnectorClient.block_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">block_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">db_name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">block_data</span><span class="p">:</span> <span class="n">Dict</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="BaseMPIConnectorClient.block_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseMPIConnectorClient.block_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseMPIConnectorClient.block_data-14"><a href="#BaseMPIConnectorClient.block_data-14"><span class="linenos">14</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="BaseMPIConnectorClient.block_data-15"><a href="#BaseMPIConnectorClient.block_data-15"><span class="linenos">15</span></a>    <span class="k">def</span> <span class="nf">block_data</span><span class="p">(</span><span class="n">db_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">block_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">list</span><span class="p">]:</span>
</span><span id="BaseMPIConnectorClient.block_data-16"><a href="#BaseMPIConnectorClient.block_data-16"><span class="linenos">16</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="BaseMPIConnectorClient.block_data-17"><a href="#BaseMPIConnectorClient.block_data-17"><span class="linenos">17</span></a><span class="sd">        Returns a list of lists containing records from the database that match on the</span>
</span><span id="BaseMPIConnectorClient.block_data-18"><a href="#BaseMPIConnectorClient.block_data-18"><span class="linenos">18</span></a><span class="sd">        incoming record&#39;s block values. If blocking on &#39;ZIP&#39; and the incoming record&#39;s</span>
</span><span id="BaseMPIConnectorClient.block_data-19"><a href="#BaseMPIConnectorClient.block_data-19"><span class="linenos">19</span></a><span class="sd">        zip code is &#39;90210&#39;, the resulting block of data would contain records that all</span>
</span><span id="BaseMPIConnectorClient.block_data-20"><a href="#BaseMPIConnectorClient.block_data-20"><span class="linenos">20</span></a><span class="sd">        have the same zip code of 90210.</span>
</span><span id="BaseMPIConnectorClient.block_data-21"><a href="#BaseMPIConnectorClient.block_data-21"><span class="linenos">21</span></a>
</span><span id="BaseMPIConnectorClient.block_data-22"><a href="#BaseMPIConnectorClient.block_data-22"><span class="linenos">22</span></a><span class="sd">        :param db_name: Database name.</span>
</span><span id="BaseMPIConnectorClient.block_data-23"><a href="#BaseMPIConnectorClient.block_data-23"><span class="linenos">23</span></a><span class="sd">        :param table_name: Table name.</span>
</span><span id="BaseMPIConnectorClient.block_data-24"><a href="#BaseMPIConnectorClient.block_data-24"><span class="linenos">24</span></a><span class="sd">        :param block_data: Dictionary containing key value pairs for the column name for</span>
</span><span id="BaseMPIConnectorClient.block_data-25"><a href="#BaseMPIConnectorClient.block_data-25"><span class="linenos">25</span></a><span class="sd">        blocking and the data for the incoming record, e.g., [&quot;ZIP&quot;]: &quot;90210&quot;.</span>
</span><span id="BaseMPIConnectorClient.block_data-26"><a href="#BaseMPIConnectorClient.block_data-26"><span class="linenos">26</span></a><span class="sd">        :return: A list of records that are within the block, e.g., records that all</span>
</span><span id="BaseMPIConnectorClient.block_data-27"><a href="#BaseMPIConnectorClient.block_data-27"><span class="linenos">27</span></a><span class="sd">        have 90210 as their ZIP.</span>
</span><span id="BaseMPIConnectorClient.block_data-28"><a href="#BaseMPIConnectorClient.block_data-28"><span class="linenos">28</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BaseMPIConnectorClient.block_data-29"><a href="#BaseMPIConnectorClient.block_data-29"><span class="linenos">29</span></a>        <span class="k">pass</span>  <span class="c1"># pragma: no cover</span>
</span></pre></div>


            <div class="docstring"><p>Returns a list of lists containing records from the database that match on the
incoming record's block values. If blocking on 'ZIP' and the incoming record's
zip code is '90210', the resulting block of data would contain records that all
have the same zip code of 90210.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>db_name</strong>:  Database name.</li>
<li><strong>table_name</strong>:  Table name.</li>
<li><strong>block_data</strong>:  Dictionary containing key value pairs for the column name for
blocking and the data for the incoming record, e.g., ["ZIP"]: "90210".</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>A list of records that are within the block, e.g., records that all
  have 90210 as their ZIP.</p>
</blockquote>
</div>


                            </div>
                            <div id="BaseMPIConnectorClient.upsert_match_patient" class="classattr">
                                        <input id="BaseMPIConnectorClient.upsert_match_patient-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">upsert_match_patient</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">patient_record</span><span class="p">:</span> <span class="n">Dict</span>,</span><span class="param">	<span class="n">patient_table_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">person_table_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">person_id</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="BaseMPIConnectorClient.upsert_match_patient-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseMPIConnectorClient.upsert_match_patient"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseMPIConnectorClient.upsert_match_patient-31"><a href="#BaseMPIConnectorClient.upsert_match_patient-31"><span class="linenos">31</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="BaseMPIConnectorClient.upsert_match_patient-32"><a href="#BaseMPIConnectorClient.upsert_match_patient-32"><span class="linenos">32</span></a>    <span class="k">def</span> <span class="nf">upsert_match_patient</span><span class="p">(</span>
</span><span id="BaseMPIConnectorClient.upsert_match_patient-33"><a href="#BaseMPIConnectorClient.upsert_match_patient-33"><span class="linenos">33</span></a>        <span class="n">patient_record</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="BaseMPIConnectorClient.upsert_match_patient-34"><a href="#BaseMPIConnectorClient.upsert_match_patient-34"><span class="linenos">34</span></a>        <span class="n">patient_table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="BaseMPIConnectorClient.upsert_match_patient-35"><a href="#BaseMPIConnectorClient.upsert_match_patient-35"><span class="linenos">35</span></a>        <span class="n">person_table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="BaseMPIConnectorClient.upsert_match_patient-36"><a href="#BaseMPIConnectorClient.upsert_match_patient-36"><span class="linenos">36</span></a>        <span class="n">person_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="BaseMPIConnectorClient.upsert_match_patient-37"><a href="#BaseMPIConnectorClient.upsert_match_patient-37"><span class="linenos">37</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="BaseMPIConnectorClient.upsert_match_patient-38"><a href="#BaseMPIConnectorClient.upsert_match_patient-38"><span class="linenos">38</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="BaseMPIConnectorClient.upsert_match_patient-39"><a href="#BaseMPIConnectorClient.upsert_match_patient-39"><span class="linenos">39</span></a><span class="sd">        If a matching person ID has been found in the MPI, inserts a new patient into</span>
</span><span id="BaseMPIConnectorClient.upsert_match_patient-40"><a href="#BaseMPIConnectorClient.upsert_match_patient-40"><span class="linenos">40</span></a><span class="sd">        the patient table and updates the person table to link to the new patient; else</span>
</span><span id="BaseMPIConnectorClient.upsert_match_patient-41"><a href="#BaseMPIConnectorClient.upsert_match_patient-41"><span class="linenos">41</span></a><span class="sd">        inserts a new patient into the patient table and inserts a new person into the</span>
</span><span id="BaseMPIConnectorClient.upsert_match_patient-42"><a href="#BaseMPIConnectorClient.upsert_match_patient-42"><span class="linenos">42</span></a><span class="sd">        person table with a new personID, linking the new personID to the new patient.</span>
</span><span id="BaseMPIConnectorClient.upsert_match_patient-43"><a href="#BaseMPIConnectorClient.upsert_match_patient-43"><span class="linenos">43</span></a>
</span><span id="BaseMPIConnectorClient.upsert_match_patient-44"><a href="#BaseMPIConnectorClient.upsert_match_patient-44"><span class="linenos">44</span></a><span class="sd">        :param patient_record: A FHIR patient resource.</span>
</span><span id="BaseMPIConnectorClient.upsert_match_patient-45"><a href="#BaseMPIConnectorClient.upsert_match_patient-45"><span class="linenos">45</span></a><span class="sd">        :param patient_table_name: Name of patient table to update or insert into.</span>
</span><span id="BaseMPIConnectorClient.upsert_match_patient-46"><a href="#BaseMPIConnectorClient.upsert_match_patient-46"><span class="linenos">46</span></a><span class="sd">        :param person_table_name: Name of person table to update or insert into.</span>
</span><span id="BaseMPIConnectorClient.upsert_match_patient-47"><a href="#BaseMPIConnectorClient.upsert_match_patient-47"><span class="linenos">47</span></a><span class="sd">        :param person_id: The personID matching the patient record if a match has been</span>
</span><span id="BaseMPIConnectorClient.upsert_match_patient-48"><a href="#BaseMPIConnectorClient.upsert_match_patient-48"><span class="linenos">48</span></a><span class="sd">        found in the MPI, defaults to None.</span>
</span><span id="BaseMPIConnectorClient.upsert_match_patient-49"><a href="#BaseMPIConnectorClient.upsert_match_patient-49"><span class="linenos">49</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BaseMPIConnectorClient.upsert_match_patient-50"><a href="#BaseMPIConnectorClient.upsert_match_patient-50"><span class="linenos">50</span></a>        <span class="k">pass</span>  <span class="c1"># pragma: no cover</span>
</span></pre></div>


            <div class="docstring"><p>If a matching person ID has been found in the MPI, inserts a new patient into
the patient table and updates the person table to link to the new patient; else
inserts a new patient into the patient table and inserts a new person into the
person table with a new personID, linking the new personID to the new patient.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>patient_record</strong>:  A FHIR patient resource.</li>
<li><strong>patient_table_name</strong>:  Name of patient table to update or insert into.</li>
<li><strong>person_table_name</strong>:  Name of person table to update or insert into.</li>
<li><strong>person_id</strong>:  The personID matching the patient record if a match has been
found in the MPI, defaults to None.</li>
</ul>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>